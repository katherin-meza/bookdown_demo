[["api-and-iterations.html", "My Bookdown Chapter 1 API and Iterations 1.1 APIs 1.2 NPS Visitation Data 1.3 Functions 1.4 Functionize API Pulls 1.5 Function Defaults 1.6 Iterations 1.7 For loops 1.8 Mapping", " My Bookdown YOUR NAME 2023-03-02 Chapter 1 API and Iterations 1.0.1 Lesson Objectives In this lesson we will download data using an application programming interface (API), create our own functions, and iterate using for loops and map(). To fulfill these objectives we will be utilizing two park visitation data sets from the National Park Service (NPS): NPS-wide visitation data, and park unit-specific visitation data. There are seven exercises in this lesson that must be completed. 1.1 APIs An API is software that acts as an intermediary between an online data warehouse (or server) and its users (or clients). As data scientists, APIs provide us a way to request clean and nicely-formatted data that the server will then send to our local computers, all within our RStudio console! To work with APIs, we will need to use two new packages: httr, which allows us to communicate with the API’s server, and jsonlite, which allows us to work with one of the most common API data formats, JSON. Let’s go ahead and load in our packages for this lesson: library(tidyverse) library(httr) library(jsonlite) 1.2 NPS Visitation Data This week, we will be exploring NPS visitor use data across the NPS system as a whole, and and across specific park units. Like many institutions, NPS has a server that stores all of this information (as well as many other things), and an API for users to be able to access it. To utilize the NPS API in R, we first need to explore its API’s data structure. In almost every case, we use URLs to access specific data from APIs. To find the access URL for NPS visitation data, go to Stats Rest API - Documentation (though not very intuitive, the NPS API calls its visitation data set “Stats”). Listed there you will see that all data associated with the “Stats” data set can be accessed using the base URL https://irmaservices.nps.gov/v3/rest/stats. From there, you can tack on additional html text to access two different data sets: total/{year} and visitation. For starters, let’s try accessing the total/{year}. This data set gives us total monthly visitation across all NPS park units, for a user-selected year: https://irmaservices.nps.gov/v3/rest/stats/total/{YEAR} If you tried accessing that URL, you’ll have noticed it doesn’t take you anywhere. This is because the curly brackets {} signify locations in the URL that need to be updated by the user based on their specific needs. I’m curious about visitor use in my birth year, so let’s tweak the URL to access visitation data from 1992. In R, we can access this data using httr’s GET() function, replacing {YEAR} with 1992. raw_data &lt;- httr::GET(url = &quot;https://irmaservices.nps.gov/v3/rest/stats/total/1992&quot;) str(raw_data ) ## List of 10 ## $ url : chr &quot;https://irmaservices.nps.gov/v3/rest/stats/total/1992&quot; ## $ status_code: int 200 ## $ headers :List of 10 ## ..$ cache-control : chr &quot;private&quot; ## ..$ content-type : chr &quot;application/json; charset=utf-8&quot; ## ..$ server : chr &quot;Web Server&quot; ## ..$ set-cookie : chr &quot;ASP.NET_SessionID=oqnih23xojrlhznr1e2lfm5j; path=/; secure; HttpOnly; SameSite=Lax&quot; ## ..$ x-aspnet-version : chr &quot;4.0.30319&quot; ## ..$ frame-ancestors : chr &quot;*.nps.gov&quot; ## ..$ strict-transport-security: chr &quot;max-age=31536000; includeSubDomains&quot; ## ..$ date : chr &quot;Fri, 03 Mar 2023 05:07:35 GMT&quot; ## ..$ content-length : chr &quot;1420&quot; ## ..$ strict-transport-security: chr &quot;max-age=31536000; includeSubDomains; preload&quot; ## ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;insensitive&quot; &quot;list&quot; ## $ all_headers:List of 1 ## ..$ :List of 3 ## .. ..$ status : int 200 ## .. ..$ version: chr &quot;HTTP/1.1&quot; ## .. ..$ headers:List of 10 ## .. .. ..$ cache-control : chr &quot;private&quot; ## .. .. ..$ content-type : chr &quot;application/json; charset=utf-8&quot; ## .. .. ..$ server : chr &quot;Web Server&quot; ## .. .. ..$ set-cookie : chr &quot;ASP.NET_SessionID=oqnih23xojrlhznr1e2lfm5j; path=/; secure; HttpOnly; SameSite=Lax&quot; ## .. .. ..$ x-aspnet-version : chr &quot;4.0.30319&quot; ## .. .. ..$ frame-ancestors : chr &quot;*.nps.gov&quot; ## .. .. ..$ strict-transport-security: chr &quot;max-age=31536000; includeSubDomains&quot; ## .. .. ..$ date : chr &quot;Fri, 03 Mar 2023 05:07:35 GMT&quot; ## .. .. ..$ content-length : chr &quot;1420&quot; ## .. .. ..$ strict-transport-security: chr &quot;max-age=31536000; includeSubDomains; preload&quot; ## .. .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;insensitive&quot; &quot;list&quot; ## $ cookies :&#39;data.frame&#39;: 1 obs. of 7 variables: ## ..$ domain : chr &quot;#HttpOnly_irmaservices.nps.gov&quot; ## ..$ flag : logi FALSE ## ..$ path : chr &quot;/&quot; ## ..$ secure : logi TRUE ## ..$ expiration: POSIXct[1:1], format: &quot;Inf&quot; ## ..$ name : chr &quot;ASP.NET_SessionID&quot; ## ..$ value : chr &quot;oqnih23xojrlhznr1e2lfm5j&quot; ## $ content : raw [1:1420] 5b 7b 22 4d ... ## $ date : POSIXct[1:1], format: &quot;2023-03-03 05:07:35&quot; ## $ times : Named num [1:6] 0 0.043 0.124 0.273 1.936 ... ## ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;redirect&quot; &quot;namelookup&quot; &quot;connect&quot; &quot;pretransfer&quot; ... ## $ request :List of 7 ## ..$ method : chr &quot;GET&quot; ## ..$ url : chr &quot;https://irmaservices.nps.gov/v3/rest/stats/total/1992&quot; ## ..$ headers : Named chr &quot;application/json, text/xml, application/xml, */*&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;Accept&quot; ## ..$ fields : NULL ## ..$ options :List of 2 ## .. ..$ useragent: chr &quot;libcurl/7.64.1 r-curl/4.3.3 httr/1.4.4&quot; ## .. ..$ httpget : logi TRUE ## ..$ auth_token: NULL ## ..$ output : list() ## .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;write_memory&quot; &quot;write_function&quot; ## ..- attr(*, &quot;class&quot;)= chr &quot;request&quot; ## $ handle :Class &#39;curl_handle&#39; &lt;externalptr&gt; ## - attr(*, &quot;class&quot;)= chr &quot;response&quot; Viewing the data set as-is, you can see it is not super human-readable. This is because data sent from APIs is typically packaged using JavaScript Object Notation (JSON). To unpack the data, we will first need to use httr’s content() function. In this example, we want the data to be extracted as text, since this is a data table. Moreover, its encoding is listed as UTF-8. The encoding parameter can be found by opening our raw data set in our R console: raw_data # lists &#39;UTF-8&#39; ## Response [https://irmaservices.nps.gov/v3/rest/stats/total/1992] ## Date: 2023-03-03 05:07 ## Status: 200 ## Content-Type: application/json; charset=utf-8 ## Size: 1.42 kB # convert content to text unpacked_data &lt;- httr::content(raw_data, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) Second, we need to transform this string of text, which is still in JSON formatting, into a data frame using jsonlite’s fromJSON(): # parse text from JSON to data frame final_data &lt;- jsonlite::fromJSON(unpacked_data) head(final_data) ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 6209285 10940618 NA NA 1992 ## 2 2 6010027 11931340 NA NA 1992 ## 3 3 6756902 15369139 NA NA 1992 ## 4 4 7255782 21458739 NA NA 1992 ## 5 5 7690763 26648530 NA NA 1992 ## 6 6 7593227 33284625 NA NA 1992 Hooray, you have now successfully pulled in an online data set using an API!  1.2.1 Exercise #1 Using the code above as a starting point, pull in monthly NPS-wide visitation data for the years 1980, 1999, and 2018. #Creating a function raw_dara_1980&lt;-GET(url = &quot;https://irmaservices.nps.gov/v3/rest/stats/total/1980&quot;) unpack_data_1980&lt;- httr::content(raw_dara_1980, as= &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_1980&lt;- jsonlite::fromJSON(unpack_data_1980) final_data_1980 ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 5889356 7460393 NA NA 1980 ## 2 2 5445680 7710887 NA NA 1980 ## 3 3 5805470 11218075 NA NA 1980 ## 4 4 6645552 16022120 NA NA 1980 ## 5 5 6731887 20835342 NA NA 1980 ## 6 6 6803950 26744946 NA NA 1980 ## 7 7 7475505 37275095 NA NA 1980 ## 8 8 6958916 34175930 NA NA 1980 ## 9 9 7088831 20747489 NA NA 1980 ## 10 10 7095629 18109926 NA NA 1980 ## 11 11 6646680 11495645 NA NA 1980 ## 12 12 7273415 8667363 NA NA 1980 raw_data_1999&lt;-GET(url = &quot;https://irmaservices.nps.gov/v3/rest/stats/total/1999&quot;) unpack_data_1999&lt;-httr::content(raw_data_1999, as=&quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_1999&lt;-jsonlite::fromJSON(unpack_data_1999) final_data_1999 ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 11250423 10791315 NA NA 1999 ## 2 2 10680926 12526727 NA NA 1999 ## 3 3 12121612 17326973 NA NA 1999 ## 4 4 12356338 23327872 NA NA 1999 ## 5 5 13089518 27994468 NA NA 1999 ## 6 6 12832664 33496802 NA NA 1999 ## 7 7 13677895 42072518 NA NA 1999 ## 8 8 13044805 38013029 NA NA 1999 ## 9 9 12413966 27748261 NA NA 1999 ## 10 10 13097896 24341909 NA NA 1999 ## 11 11 12557324 16852702 NA NA 1999 ## 12 12 12041632 12638303 NA NA 1999 raw_data_2018&lt;-GET(url = &quot;https://irmaservices.nps.gov/v3/rest/stats/total/2018&quot;) unpack_data_2018&lt;-httr::content(raw_data_2018, as=&quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_2018&lt;-jsonlite::fromJSON(unpack_data_2018) final_data_2018 ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 13712113 12635938 NA NA 2018 ## 2 2 12830242 13822694 NA NA 2018 ## 3 3 14575360 21035485 NA NA 2018 ## 4 4 14265408 25889186 NA NA 2018 ## 5 5 14190347 32211085 NA NA 2018 ## 6 6 14872373 39331983 NA NA 2018 ## 7 7 15334272 44636360 NA NA 2018 ## 8 8 14900808 39182620 NA NA 2018 ## 9 9 14251591 31323509 NA NA 2018 ## 10 10 14059432 26474952 NA NA 2018 ## 11 11 13645350 17774444 NA NA 2018 ## 12 12 13693455 13893577 NA NA 2018 1.2.2 Exercise #2 Now, let’s explore the second NPS visitation data set, visitation. This call pulls in monthly data for a specific park, across a specific time frame. Use your new API skills to pull in visitation data for Rocky Mountain National Park from 2010 through 2021, based on the API’s URL template. The unit code for Rocky Mountain National Park is ROMO. (Hint: an API URL can have multiple sections that need to be updated by the user.) raw_data_1&lt;- httr::GET(url = &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=ROMO&amp;startYear=2010&amp;endYear=2021&quot;) unpacked_data &lt;- httr::content(raw_data_1, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data &lt;- jsonlite::fromJSON(unpacked_data) final_data ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 9833 64618 ROMO Rocky Mountain NP 2010 ## 2 2 6835 44576 ROMO Rocky Mountain NP 2010 ## 3 3 6778 70117 ROMO Rocky Mountain NP 2010 ## 4 4 6737 69097 ROMO Rocky Mountain NP 2010 ## 5 5 11780 180710 ROMO Rocky Mountain NP 2010 ## 6 6 22443 441738 ROMO Rocky Mountain NP 2010 ## 7 7 30683 668418 ROMO Rocky Mountain NP 2010 ## 8 8 29990 574638 ROMO Rocky Mountain NP 2010 ## 9 9 22514 461942 ROMO Rocky Mountain NP 2010 ## 10 10 10845 245770 ROMO Rocky Mountain NP 2010 ## 11 11 7714 67862 ROMO Rocky Mountain NP 2010 ## 12 12 6474 66335 ROMO Rocky Mountain NP 2010 ## 13 1 8131 68641 ROMO Rocky Mountain NP 2011 ## 14 2 6085 50540 ROMO Rocky Mountain NP 2011 ## 15 3 7229 73760 ROMO Rocky Mountain NP 2011 ## 16 4 5940 77183 ROMO Rocky Mountain NP 2011 ## 17 5 10025 163587 ROMO Rocky Mountain NP 2011 ## 18 6 27264 500733 ROMO Rocky Mountain NP 2011 ## 19 7 29070 743741 ROMO Rocky Mountain NP 2011 ## 20 8 25498 620534 ROMO Rocky Mountain NP 2011 ## 21 9 22179 483780 ROMO Rocky Mountain NP 2011 ## 22 10 9157 264617 ROMO Rocky Mountain NP 2011 ## 23 11 6514 68076 ROMO Rocky Mountain NP 2011 ## 24 12 11581 61749 ROMO Rocky Mountain NP 2011 ## 25 1 90 68537 ROMO Rocky Mountain NP 2012 ## 26 2 50 62036 ROMO Rocky Mountain NP 2012 ## 27 3 80 104374 ROMO Rocky Mountain NP 2012 ## 28 4 70 117053 ROMO Rocky Mountain NP 2012 ## 29 5 490 228950 ROMO Rocky Mountain NP 2012 ## 30 6 1400 500206 ROMO Rocky Mountain NP 2012 ## 31 7 2050 651722 ROMO Rocky Mountain NP 2012 ## 32 8 2300 589131 ROMO Rocky Mountain NP 2012 ## 33 9 1500 527172 ROMO Rocky Mountain NP 2012 ## 34 10 560 219946 ROMO Rocky Mountain NP 2012 ## 35 11 100 93714 ROMO Rocky Mountain NP 2012 ## 36 12 60 66776 ROMO Rocky Mountain NP 2012 ## 37 1 90 78022 ROMO Rocky Mountain NP 2013 ## 38 2 50 68831 ROMO Rocky Mountain NP 2013 ## 39 3 80 89691 ROMO Rocky Mountain NP 2013 ## 40 4 70 90379 ROMO Rocky Mountain NP 2013 ## 41 5 490 239184 ROMO Rocky Mountain NP 2013 ## 42 6 1400 602508 ROMO Rocky Mountain NP 2013 ## 43 7 2050 712583 ROMO Rocky Mountain NP 2013 ## 44 8 2300 621852 ROMO Rocky Mountain NP 2013 ## 45 9 1500 253467 ROMO Rocky Mountain NP 2013 ## 46 10 560 66275 ROMO Rocky Mountain NP 2013 ## 47 11 100 86379 ROMO Rocky Mountain NP 2013 ## 48 12 60 81970 ROMO Rocky Mountain NP 2013 ## 49 1 90 77633 ROMO Rocky Mountain NP 2014 ## 50 2 50 76881 ROMO Rocky Mountain NP 2014 ## 51 3 80 99077 ROMO Rocky Mountain NP 2014 ## 52 4 70 97100 ROMO Rocky Mountain NP 2014 ## 53 5 490 220532 ROMO Rocky Mountain NP 2014 ## 54 6 1400 538725 ROMO Rocky Mountain NP 2014 ## 55 7 2050 693685 ROMO Rocky Mountain NP 2014 ## 56 8 2300 616826 ROMO Rocky Mountain NP 2014 ## 57 9 1500 537694 ROMO Rocky Mountain NP 2014 ## 58 10 560 305651 ROMO Rocky Mountain NP 2014 ## 59 11 100 90915 ROMO Rocky Mountain NP 2014 ## 60 12 60 80032 ROMO Rocky Mountain NP 2014 ## 61 1 90 98928 ROMO Rocky Mountain NP 2015 ## 62 2 50 85123 ROMO Rocky Mountain NP 2015 ## 63 3 80 134304 ROMO Rocky Mountain NP 2015 ## 64 4 70 116959 ROMO Rocky Mountain NP 2015 ## 65 5 490 259711 ROMO Rocky Mountain NP 2015 ## 66 6 1400 608796 ROMO Rocky Mountain NP 2015 ## 67 7 2050 858426 ROMO Rocky Mountain NP 2015 ## 68 8 2300 765579 ROMO Rocky Mountain NP 2015 ## 69 9 1500 644350 ROMO Rocky Mountain NP 2015 ## 70 10 560 371558 ROMO Rocky Mountain NP 2015 ## 71 11 100 118398 ROMO Rocky Mountain NP 2015 ## 72 12 60 93784 ROMO Rocky Mountain NP 2015 ## 73 1 90 115207 ROMO Rocky Mountain NP 2016 ## 74 2 50 105125 ROMO Rocky Mountain NP 2016 ## 75 3 80 135053 ROMO Rocky Mountain NP 2016 ## 76 4 70 129967 ROMO Rocky Mountain NP 2016 ## 77 5 490 285868 ROMO Rocky Mountain NP 2016 ## 78 6 1400 700990 ROMO Rocky Mountain NP 2016 ## 79 7 2050 912507 ROMO Rocky Mountain NP 2016 ## 80 8 2300 772849 ROMO Rocky Mountain NP 2016 ## 81 9 1500 711110 ROMO Rocky Mountain NP 2016 ## 82 10 560 398525 ROMO Rocky Mountain NP 2016 ## 83 11 100 158553 ROMO Rocky Mountain NP 2016 ## 84 12 60 91831 ROMO Rocky Mountain NP 2016 ## 85 1 90 95602 ROMO Rocky Mountain NP 2017 ## 86 2 50 98832 ROMO Rocky Mountain NP 2017 ## 87 3 80 145110 ROMO Rocky Mountain NP 2017 ## 88 4 70 158360 ROMO Rocky Mountain NP 2017 ## 89 5 490 263222 ROMO Rocky Mountain NP 2017 ## 90 6 1400 741247 ROMO Rocky Mountain NP 2017 ## 91 7 2050 885478 ROMO Rocky Mountain NP 2017 ## 92 8 2300 782625 ROMO Rocky Mountain NP 2017 ## 93 9 1500 681160 ROMO Rocky Mountain NP 2017 ## 94 10 560 332526 ROMO Rocky Mountain NP 2017 ## 95 11 100 140223 ROMO Rocky Mountain NP 2017 ## 96 12 60 112830 ROMO Rocky Mountain NP 2017 ## 97 1 90 111422 ROMO Rocky Mountain NP 2018 ## 98 2 50 84245 ROMO Rocky Mountain NP 2018 ## 99 3 80 156434 ROMO Rocky Mountain NP 2018 ## 100 4 70 151975 ROMO Rocky Mountain NP 2018 ## 101 5 490 305993 ROMO Rocky Mountain NP 2018 ## 102 6 1400 720822 ROMO Rocky Mountain NP 2018 ## 103 7 2050 931929 ROMO Rocky Mountain NP 2018 ## 104 8 2300 798306 ROMO Rocky Mountain NP 2018 ## 105 9 1500 784480 ROMO Rocky Mountain NP 2018 ## 106 10 560 312757 ROMO Rocky Mountain NP 2018 ## 107 11 100 125349 ROMO Rocky Mountain NP 2018 ## 108 12 60 106781 ROMO Rocky Mountain NP 2018 ## 109 1 90 118152 ROMO Rocky Mountain NP 2019 ## 110 2 50 99873 ROMO Rocky Mountain NP 2019 ## 111 3 80 146414 ROMO Rocky Mountain NP 2019 ## 112 4 70 160259 ROMO Rocky Mountain NP 2019 ## 113 5 490 280351 ROMO Rocky Mountain NP 2019 ## 114 6 1400 698224 ROMO Rocky Mountain NP 2019 ## 115 7 2050 973992 ROMO Rocky Mountain NP 2019 ## 116 8 2300 830039 ROMO Rocky Mountain NP 2019 ## 117 9 1500 752320 ROMO Rocky Mountain NP 2019 ## 118 10 560 374003 ROMO Rocky Mountain NP 2019 ## 119 11 100 123376 ROMO Rocky Mountain NP 2019 ## 120 12 60 113050 ROMO Rocky Mountain NP 2019 ## 121 1 90 126866 ROMO Rocky Mountain NP 2020 ## 122 2 50 110667 ROMO Rocky Mountain NP 2020 ## 123 3 80 97690 ROMO Rocky Mountain NP 2020 ## 124 4 70 0 ROMO Rocky Mountain NP 2020 ## 125 5 490 63051 ROMO Rocky Mountain NP 2020 ## 126 6 1400 491355 ROMO Rocky Mountain NP 2020 ## 127 7 2050 723478 ROMO Rocky Mountain NP 2020 ## 128 8 2300 580368 ROMO Rocky Mountain NP 2020 ## 129 9 1500 500019 ROMO Rocky Mountain NP 2020 ## 130 10 560 297665 ROMO Rocky Mountain NP 2020 ## 131 11 100 157875 ROMO Rocky Mountain NP 2020 ## 132 12 60 156165 ROMO Rocky Mountain NP 2020 ## 133 1 90 140715 ROMO Rocky Mountain NP 2021 ## 134 2 50 133771 ROMO Rocky Mountain NP 2021 ## 135 3 80 155819 ROMO Rocky Mountain NP 2021 ## 136 4 70 183792 ROMO Rocky Mountain NP 2021 ## 137 5 490 335060 ROMO Rocky Mountain NP 2021 ## 138 6 1400 671232 ROMO Rocky Mountain NP 2021 ## 139 7 2050 904767 ROMO Rocky Mountain NP 2021 ## 140 8 2300 746343 ROMO Rocky Mountain NP 2021 ## 141 9 1500 521233 ROMO Rocky Mountain NP 2021 ## 142 10 560 352736 ROMO Rocky Mountain NP 2021 ## 143 11 100 164992 ROMO Rocky Mountain NP 2021 ## 144 12 60 124388 ROMO Rocky Mountain NP 2021 1.3 Functions You may find yourself thinking, “Wow, exercise 1 was overkill!” Indeed, you had to run several lines of code that were nearly identical to what was shown upstream; the only thing you needed to change from one year to the next was the year itself. This sort of redundant coding is not good coding practice. Instead of copying and pasting many coding steps over and over again and tweaking just a tiny portion of it, we can write functions that combine many coding steps into just one command. The benefits of reducing redundant code in this way are threefold. As Grolemund &amp; Wickham describe in their book, R for Data Science: It’s easier to see the intent of your code, because your eyes are drawn to what’s different, not what stays the same. It’s easier to respond to changes in requirements. As your needs change, you only need to make changes in one place, rather than remembering to change every place that you copied-and-pasted the code. You’re likely to have fewer bugs because each line of code is used in more places. Functions provide the option of changing just a minor part of the code base from one run to the next. Think of the GET() function in httr: it is a function that has code under-the-hood so that it isn’t necessary to write out the raw code each time we use it. Instead, we call out the function’s name (GET()), and the necessary argument within that function that tweaks the code to fit it to our needs (url = \"&lt;SOME_URL_WE_CHOOSE&gt;\"). 1.4 Functionize API Pulls Let’s try making a function called parkwide_visitation() that pulls in NPS-wide visitation data for a year of choice. To develop a function requires specific formatting: &lt;NAME&gt; &lt;- function(&lt;ARGUMENTS&gt;){ &lt;ACTIONS&gt; return(&lt;OUTPUT&gt;) } … where NAME is what we want to name the function; ARGUMENTS are the variables in the code that get “tweaked”; ACTIONS are the lines of code we want the function to perform (which includes our ARGUMENTS); and the OUTPUT is the object we want as the final outcome of running the function. For parkwide_visitation(), we will use our upstream code as the basis for our function, but with a few minor yet extremely important tweaks: parkwide_visitation &lt;- function(year){ # pull in the data raw_data &lt;- httr::GET(url = # parse out year so that it can be chosen with the &quot;year&quot; argument, using paste0() paste0(&quot;https://irmaservices.nps.gov/v3/rest/stats/total/&quot;, year)) # convert content to text extracted_data &lt;- httr::content(raw_data, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) # parse text from JSON to data frame final_data &lt;- jsonlite::fromJSON(extracted_data) return(final_data) } In the above function, our first object, raw_data, now changes based on how we define our year argument. We accomplish this through paste0(), which takes listed objects, transforms them into characters (if they aren’t already), and concatenates them into a single character string. For example: my_sentence &lt;- &quot;I need at least&quot; my_other_sentence &lt;- &quot;pints of ice cream a day&quot; paste0(my_sentence, &quot; &quot;, 08, &quot; &quot;, my_other_sentence, &quot;!&quot;) ## [1] &quot;I need at least 8 pints of ice cream a day!&quot; So, if we make year = 2021 in our parkwide_visitation() function, the year object becomes the number 2021, which makes the paste0() output “https://irmaservices.nps.gov/v3/rest/stats/total/2021”, which subsequently pulls data for 2021. In other words, we can now pull visitation data for any year with just one line of code! pull_2018 &lt;- parkwide_visitation(year = 2018) pull_1980 &lt;- parkwide_visitation(year = 1980) pull_1992 &lt;- parkwide_visitation(year = 1992) # ... and so on! 1.4.1 Exercise #3 Create a function called unit_visitation() that pulls park-specific visitation data for any park, across any time frame. For a list of all park codes, download this spreadsheet. (Hint 1: functions can have multiple arguments. Hint 2: what’s the difference between 05 and \"05\"?) #Downloading data to know all the code for parks and saved in our file all_park_code&lt;- GET(url = &quot;https://www.nps.gov/aboutus/foia/upload/NPS-Unit-List.xlsx&quot;) unpaking_all_code&lt;- content(all_park_code, as= &quot;raw&quot;) writeBin(unpaking_all_code, &quot;NPS-Unit-List.xlsx&quot;) #From our previous link we are going to pull and to have a new data frame similar as what we will build with the function get_data&lt;- GET(url = &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=YELL&amp;startMonth=1&amp;startYear=2015&amp;endMonth=12&amp;endYear=2016&quot;) extracted_data_example &lt;- httr::content(get_data, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_all &lt;- jsonlite::fromJSON(extracted_data_example ) final_data_all ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 53478 28091 YELL Yellowstone NP 2015 ## 2 2 55693 34343 YELL Yellowstone NP 2015 ## 3 3 65087 22989 YELL Yellowstone NP 2015 ## 4 4 62472 46600 YELL Yellowstone NP 2015 ## 5 5 98137 386064 YELL Yellowstone NP 2015 ## 6 6 148865 780768 YELL Yellowstone NP 2015 ## 7 7 190369 980702 YELL Yellowstone NP 2015 ## 8 8 168410 854408 YELL Yellowstone NP 2015 ## 9 9 131438 680213 YELL Yellowstone NP 2015 ## 10 10 84572 252013 YELL Yellowstone NP 2015 ## 11 11 49416 11049 YELL Yellowstone NP 2015 ## 12 12 48181 20470 YELL Yellowstone NP 2015 ## 13 1 51099 30621 YELL Yellowstone NP 2016 ## 14 2 55180 36327 YELL Yellowstone NP 2016 ## 15 3 62138 22924 YELL Yellowstone NP 2016 ## 16 4 64044 59253 YELL Yellowstone NP 2016 ## 17 5 105417 444630 YELL Yellowstone NP 2016 ## 18 6 156070 838316 YELL Yellowstone NP 2016 ## 19 7 192910 995917 YELL Yellowstone NP 2016 ## 20 8 176451 841036 YELL Yellowstone NP 2016 ## 21 9 142449 701754 YELL Yellowstone NP 2016 ## 22 10 84598 242004 YELL Yellowstone NP 2016 ## 23 11 60954 24710 YELL Yellowstone NP 2016 ## 24 12 47546 19685 YELL Yellowstone NP 2016 #Creating a unit_visitation function year_start&lt;- (2015) year_end&lt;-(2017) month_start&lt;- (1) month_end&lt;-(12) id_name&lt;-(&quot;YELL&quot;) #this is the format of the complex link === https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes={UNITCODES}&amp;startMonth={STARTMONTH}&amp;startYear={STARTYEAR}&amp;endMonth={ENDMONTH}&amp;endYear={ENDYEAR} unit_visitation&lt;- function(year_start,year_end, month_start,month_end,id_name){ get_data_year&lt;- GET(url =paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } test&lt;-unit_visitation(year_start,year_end, month_start,month_end,id_name) test ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 53478 28091 YELL Yellowstone NP 2015 ## 2 2 55693 34343 YELL Yellowstone NP 2015 ## 3 3 65087 22989 YELL Yellowstone NP 2015 ## 4 4 62472 46600 YELL Yellowstone NP 2015 ## 5 5 98137 386064 YELL Yellowstone NP 2015 ## 6 6 148865 780768 YELL Yellowstone NP 2015 ## 7 7 190369 980702 YELL Yellowstone NP 2015 ## 8 8 168410 854408 YELL Yellowstone NP 2015 ## 9 9 131438 680213 YELL Yellowstone NP 2015 ## 10 10 84572 252013 YELL Yellowstone NP 2015 ## 11 11 49416 11049 YELL Yellowstone NP 2015 ## 12 12 48181 20470 YELL Yellowstone NP 2015 ## 13 1 51099 30621 YELL Yellowstone NP 2016 ## 14 2 55180 36327 YELL Yellowstone NP 2016 ## 15 3 62138 22924 YELL Yellowstone NP 2016 ## 16 4 64044 59253 YELL Yellowstone NP 2016 ## 17 5 105417 444630 YELL Yellowstone NP 2016 ## 18 6 156070 838316 YELL Yellowstone NP 2016 ## 19 7 192910 995917 YELL Yellowstone NP 2016 ## 20 8 176451 841036 YELL Yellowstone NP 2016 ## 21 9 142449 701754 YELL Yellowstone NP 2016 ## 22 10 84598 242004 YELL Yellowstone NP 2016 ## 23 11 60954 24710 YELL Yellowstone NP 2016 ## 24 12 47546 19685 YELL Yellowstone NP 2016 ## 25 1 53822 29518 YELL Yellowstone NP 2017 ## 26 2 54038 32275 YELL Yellowstone NP 2017 ## 27 3 62505 23897 YELL Yellowstone NP 2017 ## 28 4 65733 45160 YELL Yellowstone NP 2017 ## 29 5 119406 419635 YELL Yellowstone NP 2017 ## 30 6 159872 803652 YELL Yellowstone NP 2017 ## 31 7 202263 962404 YELL Yellowstone NP 2017 ## 32 8 189463 916166 YELL Yellowstone NP 2017 ## 33 9 140300 640068 YELL Yellowstone NP 2017 ## 34 10 92665 211987 YELL Yellowstone NP 2017 ## 35 11 55331 10468 YELL Yellowstone NP 2017 ## 36 12 52150 21294 YELL Yellowstone NP 2017 test&lt;-unit_visitation(year_start=2016,year_end=2017, month_start=2,month_end=6,id_name=&quot;YELL&quot;) test ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 2 55180 36327 YELL Yellowstone NP 2016 ## 2 3 62138 22924 YELL Yellowstone NP 2016 ## 3 4 64044 59253 YELL Yellowstone NP 2016 ## 4 5 105417 444630 YELL Yellowstone NP 2016 ## 5 6 156070 838316 YELL Yellowstone NP 2016 ## 6 7 192910 995917 YELL Yellowstone NP 2016 ## 7 8 176451 841036 YELL Yellowstone NP 2016 ## 8 9 142449 701754 YELL Yellowstone NP 2016 ## 9 10 84598 242004 YELL Yellowstone NP 2016 ## 10 11 60954 24710 YELL Yellowstone NP 2016 ## 11 12 47546 19685 YELL Yellowstone NP 2016 ## 12 1 53822 29518 YELL Yellowstone NP 2017 ## 13 2 54038 32275 YELL Yellowstone NP 2017 ## 14 3 62505 23897 YELL Yellowstone NP 2017 ## 15 4 65733 45160 YELL Yellowstone NP 2017 ## 16 5 119406 419635 YELL Yellowstone NP 2017 ## 17 6 159872 803652 YELL Yellowstone NP 2017 #what&#39;s the difference between `05` and `&quot;05&quot;`? ##`05` is a structure that can be recognized as integer, While &quot;05&quot; is a character data type. 1.4.2 Exercise #4 Using unit_visitation(), pull in visitation data for Rocky Mountain National Park (ROMO), Everglades National Park (EVER), and Theodore Roosevelt National Park (THRO) from 1990 through 2021. #Creating the object and the function year_start&lt;- (1990) year_end&lt;-(2021) month_start&lt;- (1) month_end&lt;-(12) id_name&lt;-(&quot;YELL&quot;) unit_visitation&lt;- function(year_start,year_end, month_start,month_end,id_name){ get_data_year&lt;- GET(url =paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } test_ROMO&lt;-unit_visitation(year_start,year_end, month_start,month_end,id_name=&quot;ROMO&quot;) head(test_ROMO) ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 10956 53565 ROMO Rocky Mountain NP 1990 ## 2 2 9343 49896 ROMO Rocky Mountain NP 1990 ## 3 3 7247 65280 ROMO Rocky Mountain NP 1990 ## 4 4 4681 60274 ROMO Rocky Mountain NP 1990 ## 5 5 11465 108881 ROMO Rocky Mountain NP 1990 ## 6 6 17173 435279 ROMO Rocky Mountain NP 1990 test_EVER&lt;-unit_visitation(year_start,year_end, month_start,month_end,id_name= &quot;EVER&quot;) head(test_ROMO) ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 10956 53565 ROMO Rocky Mountain NP 1990 ## 2 2 9343 49896 ROMO Rocky Mountain NP 1990 ## 3 3 7247 65280 ROMO Rocky Mountain NP 1990 ## 4 4 4681 60274 ROMO Rocky Mountain NP 1990 ## 5 5 11465 108881 ROMO Rocky Mountain NP 1990 ## 6 6 17173 435279 ROMO Rocky Mountain NP 1990 test_THRO&lt;-unit_visitation(year_start,year_end, month_start,month_end,id_name=&quot;THRO&quot;) head(test_ROMO) ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 10956 53565 ROMO Rocky Mountain NP 1990 ## 2 2 9343 49896 ROMO Rocky Mountain NP 1990 ## 3 3 7247 65280 ROMO Rocky Mountain NP 1990 ## 4 4 4681 60274 ROMO Rocky Mountain NP 1990 ## 5 5 11465 108881 ROMO Rocky Mountain NP 1990 ## 6 6 17173 435279 ROMO Rocky Mountain NP 1990 1.5 Function Defaults Look at the code that you just wrote; writing out all of those unchanging date arguments still feels repetitive, right? When developing functions, there is an option for setting default values for arguments so that you don’t necessarily have to write all of them out every time you run it in the future. But, the option still exists within the function to make changes when necessary. For example, let’s tweak our parkwide_visitaion() function to have the default year be 2021: parkwide_visitation &lt;- function(year = &quot;2021&quot;) { raw_data &lt;- httr::GET(url = paste0(&quot;https://irmaservices.nps.gov/v3/rest/stats/total/&quot;, year)) # convert content to text extracted_data &lt;- httr::content(raw_data, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) # parse text from JSON to data frame final_data &lt;- jsonlite::fromJSON(extracted_data) return(final_data) } parkwide_visitation() ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 11632614 11978413 NA NA 2021 ## 2 2 11082899 11692967 NA NA 2021 ## 3 3 12981524 18370611 NA NA 2021 ## 4 4 12857567 22155245 NA NA 2021 ## 5 5 13250575 27963739 NA NA 2021 ## 6 6 13789961 36122392 NA NA 2021 ## 7 7 14734920 41329530 NA NA 2021 ## 8 8 14280304 35380986 NA NA 2021 ## 9 9 13382939 30204635 NA NA 2021 ## 10 10 13882165 26961779 NA NA 2021 ## 11 11 13192146 18903397 NA NA 2021 ## 12 12 13007065 16051712 NA NA 2021 Because the default year is 2021, you don’t have to write it out explicitly in the function (so long as that’s the year you’re interested in). But, you still have the option of changing the year to something else: parkwide_visitation(year = &quot;1992&quot;) ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 6209285 10940618 NA NA 1992 ## 2 2 6010027 11931340 NA NA 1992 ## 3 3 6756902 15369139 NA NA 1992 ## 4 4 7255782 21458739 NA NA 1992 ## 5 5 7690763 26648530 NA NA 1992 ## 6 6 7593227 33284625 NA NA 1992 ## 7 7 8438755 41099305 NA NA 1992 ## 8 8 8056823 38625804 NA NA 1992 ## 9 9 7329755 26438266 NA NA 1992 ## 10 10 7105574 23616057 NA NA 1992 ## 11 11 6507805 14338165 NA NA 1992 ## 12 12 6702698 10943961 NA NA 1992 1.5.1 Exercise #5 Default our unit_visitation() function’s arguments related to the starting and ending months to January and December, respectively. This way, we are automatically pulling in data for entire years. Rerun the function for ROMO, EVER, and THRO for the 1980-2021 time period to make sure it works properly. #HERE: Replacing any code name in id_name will obtain a different data-frames for each park. #For &quot;ROMO&quot; unit_visitation&lt;- function(year_start=&quot;1980&quot;,year_end=&quot;2021&quot;, month_start=&quot;1&quot;,month_end=&quot;12&quot;,id_name=&quot;ROMO&quot;){ get_data_year&lt;- GET(url =paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } unit_visitation() ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 28 42902 ROMO Rocky Mountain NP 1980 ## 2 2 44 59403 ROMO Rocky Mountain NP 1980 ## 3 3 24 58790 ROMO Rocky Mountain NP 1980 ## 4 4 142 64299 ROMO Rocky Mountain NP 1980 ## 5 5 98 93210 ROMO Rocky Mountain NP 1980 ## 6 6 2384 410449 ROMO Rocky Mountain NP 1980 ## 7 7 3748 573465 ROMO Rocky Mountain NP 1980 ## 8 8 3634 609383 ROMO Rocky Mountain NP 1980 ## 9 9 1472 389771 ROMO Rocky Mountain NP 1980 ## 10 10 532 219495 ROMO Rocky Mountain NP 1980 ## 11 11 100 51344 ROMO Rocky Mountain NP 1980 ## 12 12 54 69426 ROMO Rocky Mountain NP 1980 ## 13 1 60 52645 ROMO Rocky Mountain NP 1981 ## 14 2 0 47256 ROMO Rocky Mountain NP 1981 ## 15 3 0 63637 ROMO Rocky Mountain NP 1981 ## 16 4 0 78529 ROMO Rocky Mountain NP 1981 ## 17 5 0 130744 ROMO Rocky Mountain NP 1981 ## 18 6 642 439671 ROMO Rocky Mountain NP 1981 ## 19 7 2130 674786 ROMO Rocky Mountain NP 1981 ## 20 8 1908 677202 ROMO Rocky Mountain NP 1981 ## 21 9 656 430738 ROMO Rocky Mountain NP 1981 ## 22 10 170 202193 ROMO Rocky Mountain NP 1981 ## 23 11 54 51650 ROMO Rocky Mountain NP 1981 ## 24 12 218 62191 ROMO Rocky Mountain NP 1981 ## 25 1 316 65547 ROMO Rocky Mountain NP 1982 ## 26 2 48 59558 ROMO Rocky Mountain NP 1982 ## 27 3 54 64554 ROMO Rocky Mountain NP 1982 ## 28 4 174 74092 ROMO Rocky Mountain NP 1982 ## 29 5 298 106375 ROMO Rocky Mountain NP 1982 ## 30 6 2796 366311 ROMO Rocky Mountain NP 1982 ## 31 7 3274 573923 ROMO Rocky Mountain NP 1982 ## 32 8 4406 613132 ROMO Rocky Mountain NP 1982 ## 33 9 2428 360870 ROMO Rocky Mountain NP 1982 ## 34 10 736 177760 ROMO Rocky Mountain NP 1982 ## 35 11 58 51377 ROMO Rocky Mountain NP 1982 ## 36 12 198 50617 ROMO Rocky Mountain NP 1982 ## 37 1 3778 67598 ROMO Rocky Mountain NP 1983 ## 38 2 2644 70480 ROMO Rocky Mountain NP 1983 ## 39 3 2560 60310 ROMO Rocky Mountain NP 1983 ## 40 4 4563 79542 ROMO Rocky Mountain NP 1983 ## 41 5 4257 91340 ROMO Rocky Mountain NP 1983 ## 42 6 9011 322393 ROMO Rocky Mountain NP 1983 ## 43 7 15891 552473 ROMO Rocky Mountain NP 1983 ## 44 8 23219 625132 ROMO Rocky Mountain NP 1983 ## 45 9 14202 432745 ROMO Rocky Mountain NP 1983 ## 46 10 10841 193914 ROMO Rocky Mountain NP 1983 ## 47 11 6370 76969 ROMO Rocky Mountain NP 1983 ## 48 12 4744 26110 ROMO Rocky Mountain NP 1983 ## 49 1 5253 51124 ROMO Rocky Mountain NP 1984 ## 50 2 4257 49126 ROMO Rocky Mountain NP 1984 ## 51 3 3165 46210 ROMO Rocky Mountain NP 1984 ## 52 4 3174 46736 ROMO Rocky Mountain NP 1984 ## 53 5 4212 75806 ROMO Rocky Mountain NP 1984 ## 54 6 14464 303393 ROMO Rocky Mountain NP 1984 ## 55 7 27018 514848 ROMO Rocky Mountain NP 1984 ## 56 8 30006 605465 ROMO Rocky Mountain NP 1984 ## 57 9 63411 355768 ROMO Rocky Mountain NP 1984 ## 58 10 75817 93927 ROMO Rocky Mountain NP 1984 ## 59 11 2951 52850 ROMO Rocky Mountain NP 1984 ## 60 12 458 36195 ROMO Rocky Mountain NP 1984 ## 61 1 5832 68416 ROMO Rocky Mountain NP 1985 ## 62 2 3676 47012 ROMO Rocky Mountain NP 1985 ## 63 3 865 55707 ROMO Rocky Mountain NP 1985 ## 64 4 1513 58854 ROMO Rocky Mountain NP 1985 ## 65 5 1949 117475 ROMO Rocky Mountain NP 1985 ## 66 6 12852 327505 ROMO Rocky Mountain NP 1985 ## 67 7 27504 501624 ROMO Rocky Mountain NP 1985 ## 68 8 26757 585115 ROMO Rocky Mountain NP 1985 ## 69 9 12828 304574 ROMO Rocky Mountain NP 1985 ## 70 10 4048 87250 ROMO Rocky Mountain NP 1985 ## 71 11 3285 52986 ROMO Rocky Mountain NP 1985 ## 72 12 4515 42336 ROMO Rocky Mountain NP 1985 ## 73 1 7281 74949 ROMO Rocky Mountain NP 1986 ## 74 2 4342 38588 ROMO Rocky Mountain NP 1986 ## 75 3 4653 58001 ROMO Rocky Mountain NP 1986 ## 76 4 2424 67259 ROMO Rocky Mountain NP 1986 ## 77 5 3197 111710 ROMO Rocky Mountain NP 1986 ## 78 6 9976 303208 ROMO Rocky Mountain NP 1986 ## 79 7 24774 547751 ROMO Rocky Mountain NP 1986 ## 80 8 27016 643670 ROMO Rocky Mountain NP 1986 ## 81 9 13184 338915 ROMO Rocky Mountain NP 1986 ## 82 10 6925 126243 ROMO Rocky Mountain NP 1986 ## 83 11 5671 45674 ROMO Rocky Mountain NP 1986 ## 84 12 5445 52266 ROMO Rocky Mountain NP 1986 ## 85 1 2917 77184 ROMO Rocky Mountain NP 1987 ## 86 2 12844 52922 ROMO Rocky Mountain NP 1987 ## 87 3 2684 54316 ROMO Rocky Mountain NP 1987 ## 88 4 3380 59363 ROMO Rocky Mountain NP 1987 ## 89 5 6704 136049 ROMO Rocky Mountain NP 1987 ## 90 6 16155 365757 ROMO Rocky Mountain NP 1987 ## 91 7 25768 546231 ROMO Rocky Mountain NP 1987 ## 92 8 26661 621584 ROMO Rocky Mountain NP 1987 ## 93 9 16015 359746 ROMO Rocky Mountain NP 1987 ## 94 10 7265 171484 ROMO Rocky Mountain NP 1987 ## 95 11 6969 50425 ROMO Rocky Mountain NP 1987 ## 96 12 5803 36803 ROMO Rocky Mountain NP 1987 ## 97 1 8191 58824 ROMO Rocky Mountain NP 1988 ## 98 2 8718 52367 ROMO Rocky Mountain NP 1988 ## 99 3 2542 56677 ROMO Rocky Mountain NP 1988 ## 100 4 3584 57933 ROMO Rocky Mountain NP 1988 ## 101 5 2016 91676 ROMO Rocky Mountain NP 1988 ## 102 6 20746 399197 ROMO Rocky Mountain NP 1988 ## 103 7 24083 568028 ROMO Rocky Mountain NP 1988 ## 104 8 30133 617184 ROMO Rocky Mountain NP 1988 ## 105 9 18607 371318 ROMO Rocky Mountain NP 1988 ## 106 10 9106 178657 ROMO Rocky Mountain NP 1988 ## 107 11 7029 55402 ROMO Rocky Mountain NP 1988 ## 108 12 7950 36948 ROMO Rocky Mountain NP 1988 ## 109 1 9784 60075 ROMO Rocky Mountain NP 1989 ## 110 2 9001 52050 ROMO Rocky Mountain NP 1989 ## 111 3 5582 60381 ROMO Rocky Mountain NP 1989 ## 112 4 2510 52044 ROMO Rocky Mountain NP 1989 ## 113 5 7934 92436 ROMO Rocky Mountain NP 1989 ## 114 6 18451 370174 ROMO Rocky Mountain NP 1989 ## 115 7 24557 590130 ROMO Rocky Mountain NP 1989 ## 116 8 21097 600617 ROMO Rocky Mountain NP 1989 ## 117 9 14738 358910 ROMO Rocky Mountain NP 1989 ## 118 10 9143 183199 ROMO Rocky Mountain NP 1989 ## 119 11 5102 54061 ROMO Rocky Mountain NP 1989 ## 120 12 5848 28838 ROMO Rocky Mountain NP 1989 ## 121 1 10956 53565 ROMO Rocky Mountain NP 1990 ## 122 2 9343 49896 ROMO Rocky Mountain NP 1990 ## 123 3 7247 65280 ROMO Rocky Mountain NP 1990 ## 124 4 4681 60274 ROMO Rocky Mountain NP 1990 ## 125 5 11465 108881 ROMO Rocky Mountain NP 1990 ## 126 6 17173 435279 ROMO Rocky Mountain NP 1990 ## 127 7 28031 560806 ROMO Rocky Mountain NP 1990 ## 128 8 30676 646018 ROMO Rocky Mountain NP 1990 ## 129 9 13162 392873 ROMO Rocky Mountain NP 1990 ## 130 10 9608 164130 ROMO Rocky Mountain NP 1990 ## 131 11 5749 73064 ROMO Rocky Mountain NP 1990 ## 132 12 5845 37257 ROMO Rocky Mountain NP 1990 ## 133 1 8071 50910 ROMO Rocky Mountain NP 1991 ## 134 2 6467 57547 ROMO Rocky Mountain NP 1991 ## 135 3 8492 56241 ROMO Rocky Mountain NP 1991 ## 136 4 6231 67986 ROMO Rocky Mountain NP 1991 ## 137 5 13124 118351 ROMO Rocky Mountain NP 1991 ## 138 6 18645 434810 ROMO Rocky Mountain NP 1991 ## 139 7 28663 614118 ROMO Rocky Mountain NP 1991 ## 140 8 25541 642734 ROMO Rocky Mountain NP 1991 ## 141 9 19042 385524 ROMO Rocky Mountain NP 1991 ## 142 10 9185 237608 ROMO Rocky Mountain NP 1991 ## 143 11 2815 43136 ROMO Rocky Mountain NP 1991 ## 144 12 5754 42816 ROMO Rocky Mountain NP 1991 ## 145 1 9398 60038 ROMO Rocky Mountain NP 1992 ## 146 2 9674 48476 ROMO Rocky Mountain NP 1992 ## 147 3 6444 58478 ROMO Rocky Mountain NP 1992 ## 148 4 4797 80217 ROMO Rocky Mountain NP 1992 ## 149 5 11308 160788 ROMO Rocky Mountain NP 1992 ## 150 6 15198 408630 ROMO Rocky Mountain NP 1992 ## 151 7 28690 606764 ROMO Rocky Mountain NP 1992 ## 152 8 24688 623634 ROMO Rocky Mountain NP 1992 ## 153 9 20790 440843 ROMO Rocky Mountain NP 1992 ## 154 10 12764 218570 ROMO Rocky Mountain NP 1992 ## 155 11 4346 47490 ROMO Rocky Mountain NP 1992 ## 156 12 5778 34940 ROMO Rocky Mountain NP 1992 ## 157 1 9015 53780 ROMO Rocky Mountain NP 1993 ## 158 2 8490 39962 ROMO Rocky Mountain NP 1993 ## 159 3 7375 52511 ROMO Rocky Mountain NP 1993 ## 160 4 5256 65790 ROMO Rocky Mountain NP 1993 ## 161 5 7498 120708 ROMO Rocky Mountain NP 1993 ## 162 6 20483 424670 ROMO Rocky Mountain NP 1993 ## 163 7 31510 623451 ROMO Rocky Mountain NP 1993 ## 164 8 36845 654327 ROMO Rocky Mountain NP 1993 ## 165 9 22219 423570 ROMO Rocky Mountain NP 1993 ## 166 10 11741 230972 ROMO Rocky Mountain NP 1993 ## [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 338 rows ] #For &quot;EVER&quot; unit_visitation&lt;- function(year_start=&quot;1980&quot;,year_end=&quot;2021&quot;, month_start=&quot;1&quot;,month_end=&quot;12&quot;,id_name=&quot;EVER&quot;){ get_data_year&lt;- GET(url =paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } unit_visitation() ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 5670 92517 EVER Everglades NP 1980 ## 2 2 4697 96585 EVER Everglades NP 1980 ## 3 3 6160 101797 EVER Everglades NP 1980 ## 4 4 5281 80500 EVER Everglades NP 1980 ## 5 5 4851 53627 EVER Everglades NP 1980 ## 6 6 4151 37721 EVER Everglades NP 1980 ## 7 7 5037 45665 EVER Everglades NP 1980 ## 8 8 4431 47624 EVER Everglades NP 1980 ## 9 9 4274 34889 EVER Everglades NP 1980 ## 10 10 4368 47387 EVER Everglades NP 1980 ## 11 11 4060 37498 EVER Everglades NP 1980 ## 12 12 5127 68434 EVER Everglades NP 1980 ## 13 1 4333 73845 EVER Everglades NP 1981 ## 14 2 5467 75996 EVER Everglades NP 1981 ## 15 3 7647 93947 EVER Everglades NP 1981 ## 16 4 5208 63246 EVER Everglades NP 1981 ## 17 5 4585 37226 EVER Everglades NP 1981 ## 18 6 4088 23647 EVER Everglades NP 1981 ## 19 7 3748 25168 EVER Everglades NP 1981 ## 20 8 4732 28262 EVER Everglades NP 1981 ## 21 9 4287 21493 EVER Everglades NP 1981 ## 22 10 4533 29005 EVER Everglades NP 1981 ## 23 11 3983 32084 EVER Everglades NP 1981 ## 24 12 5611 60802 EVER Everglades NP 1981 ## 25 1 6622 69165 EVER Everglades NP 1982 ## 26 2 5516 81665 EVER Everglades NP 1982 ## 27 3 7969 81796 EVER Everglades NP 1982 ## 28 4 6968 56259 EVER Everglades NP 1982 ## 29 5 5739 31248 EVER Everglades NP 1982 ## 30 6 5162 18985 EVER Everglades NP 1982 ## 31 7 5103 23111 EVER Everglades NP 1982 ## 32 8 5586 29049 EVER Everglades NP 1982 ## 33 9 4921 25022 EVER Everglades NP 1982 ## 34 10 5358 33944 EVER Everglades NP 1982 ## 35 11 5327 34009 EVER Everglades NP 1982 ## 36 12 5904 65915 EVER Everglades NP 1982 ## 37 1 250 72105 EVER Everglades NP 1983 ## 38 2 220 79968 EVER Everglades NP 1983 ## 39 3 297 84433 EVER Everglades NP 1983 ## 40 4 228 59209 EVER Everglades NP 1983 ## 41 5 215 44570 EVER Everglades NP 1983 ## 42 6 126 27576 EVER Everglades NP 1983 ## 43 7 84 30348 EVER Everglades NP 1983 ## 44 8 114 26189 EVER Everglades NP 1983 ## 45 9 132 23056 EVER Everglades NP 1983 ## 46 10 284 28780 EVER Everglades NP 1983 ## 47 11 281 40683 EVER Everglades NP 1983 ## 48 12 274 60522 EVER Everglades NP 1983 ## 49 1 318 78179 EVER Everglades NP 1984 ## 50 2 412 92958 EVER Everglades NP 1984 ## 51 3 385 97997 EVER Everglades NP 1984 ## 52 4 280 71594 EVER Everglades NP 1984 ## 53 5 225 36831 EVER Everglades NP 1984 ## 54 6 248 22900 EVER Everglades NP 1984 ## 55 7 177 26928 EVER Everglades NP 1984 ## 56 8 178 28283 EVER Everglades NP 1984 ## 57 9 156 26494 EVER Everglades NP 1984 ## 58 10 292 33688 EVER Everglades NP 1984 ## 59 11 302 47202 EVER Everglades NP 1984 ## 60 12 260 65604 EVER Everglades NP 1984 ## 61 1 251 87719 EVER Everglades NP 1985 ## 62 2 304 110139 EVER Everglades NP 1985 ## 63 3 339 109046 EVER Everglades NP 1985 ## 64 4 199 76131 EVER Everglades NP 1985 ## 65 5 220 41505 EVER Everglades NP 1985 ## 66 6 238 34807 EVER Everglades NP 1985 ## 67 7 232 26379 EVER Everglades NP 1985 ## 68 8 140 28732 EVER Everglades NP 1985 ## 69 9 221 24205 EVER Everglades NP 1985 ## 70 10 343 30487 EVER Everglades NP 1985 ## 71 11 327 52152 EVER Everglades NP 1985 ## 72 12 226 76344 EVER Everglades NP 1985 ## 73 1 1067 93007 EVER Everglades NP 1986 ## 74 2 2126 112967 EVER Everglades NP 1986 ## 75 3 2532 120713 EVER Everglades NP 1986 ## 76 4 2164 98993 EVER Everglades NP 1986 ## 77 5 1924 51024 EVER Everglades NP 1986 ## 78 6 1630 25271 EVER Everglades NP 1986 ## 79 7 1671 25510 EVER Everglades NP 1986 ## 80 8 1814 31136 EVER Everglades NP 1986 ## 81 9 1809 25685 EVER Everglades NP 1986 ## 82 10 2078 32164 EVER Everglades NP 1986 ## 83 11 2014 52037 EVER Everglades NP 1986 ## 84 12 2382 70565 EVER Everglades NP 1986 ## 85 1 2506 100672 EVER Everglades NP 1987 ## 86 2 2544 107662 EVER Everglades NP 1987 ## 87 3 2669 114552 EVER Everglades NP 1987 ## 88 4 2300 84997 EVER Everglades NP 1987 ## 89 5 2371 62830 EVER Everglades NP 1987 ## 90 6 2034 38834 EVER Everglades NP 1987 ## 91 7 1985 34629 EVER Everglades NP 1987 ## 92 8 2116 37656 EVER Everglades NP 1987 ## 93 9 1894 27660 EVER Everglades NP 1987 ## 94 10 1994 34663 EVER Everglades NP 1987 ## 95 11 2176 56210 EVER Everglades NP 1987 ## 96 12 3672 87128 EVER Everglades NP 1987 ## 97 1 4021 133552 EVER Everglades NP 1988 ## 98 2 3905 164724 EVER Everglades NP 1988 ## 99 3 4458 155497 EVER Everglades NP 1988 ## 100 4 3831 120486 EVER Everglades NP 1988 ## 101 5 3148 61844 EVER Everglades NP 1988 ## 102 6 2944 46557 EVER Everglades NP 1988 ## 103 7 3035 48432 EVER Everglades NP 1988 ## 104 8 3557 53154 EVER Everglades NP 1988 ## 105 9 3480 41846 EVER Everglades NP 1988 ## 106 10 3841 49613 EVER Everglades NP 1988 ## 107 11 4163 60979 EVER Everglades NP 1988 ## 108 12 4801 89504 EVER Everglades NP 1988 ## 109 1 4935 127647 EVER Everglades NP 1989 ## 110 2 4682 137603 EVER Everglades NP 1989 ## 111 3 5607 133571 EVER Everglades NP 1989 ## 112 4 5997 84281 EVER Everglades NP 1989 ## 113 5 6036 39312 EVER Everglades NP 1989 ## 114 6 3974 44556 EVER Everglades NP 1989 ## 115 7 3526 49266 EVER Everglades NP 1989 ## 116 8 3778 51713 EVER Everglades NP 1989 ## 117 9 3339 38515 EVER Everglades NP 1989 ## 118 10 3915 51415 EVER Everglades NP 1989 ## 119 11 4332 69340 EVER Everglades NP 1989 ## 120 12 4399 86153 EVER Everglades NP 1989 ## 121 1 5223 122121 EVER Everglades NP 1990 ## 122 2 4518 131994 EVER Everglades NP 1990 ## 123 3 5120 132341 EVER Everglades NP 1990 ## 124 4 4225 111298 EVER Everglades NP 1990 ## 125 5 3314 46134 EVER Everglades NP 1990 ## 126 6 3100 46676 EVER Everglades NP 1990 ## 127 7 3177 49461 EVER Everglades NP 1990 ## 128 8 3153 54334 EVER Everglades NP 1990 ## 129 9 2572 44768 EVER Everglades NP 1990 ## 130 10 2607 48656 EVER Everglades NP 1990 ## 131 11 3170 75518 EVER Everglades NP 1990 ## 132 12 4005 94624 EVER Everglades NP 1990 ## 133 1 6350 138817 EVER Everglades NP 1991 ## 134 2 5255 149194 EVER Everglades NP 1991 ## 135 3 5762 150641 EVER Everglades NP 1991 ## 136 4 5067 110235 EVER Everglades NP 1991 ## 137 5 3762 94660 EVER Everglades NP 1991 ## 138 6 4143 68937 EVER Everglades NP 1991 ## 139 7 4121 61878 EVER Everglades NP 1991 ## 140 8 3860 71602 EVER Everglades NP 1991 ## 141 9 3599 81298 EVER Everglades NP 1991 ## 142 10 4058 86312 EVER Everglades NP 1991 ## 143 11 4586 126458 EVER Everglades NP 1991 ## 144 12 5066 151982 EVER Everglades NP 1991 ## 145 1 6623 142197 EVER Everglades NP 1992 ## 146 2 5745 163917 EVER Everglades NP 1992 ## 147 3 6518 158688 EVER Everglades NP 1992 ## 148 4 5067 126842 EVER Everglades NP 1992 ## 149 5 4095 100595 EVER Everglades NP 1992 ## 150 6 3896 59923 EVER Everglades NP 1992 ## 151 7 4011 70128 EVER Everglades NP 1992 ## 152 8 2615 59786 EVER Everglades NP 1992 ## 153 9 0 7610 EVER Everglades NP 1992 ## 154 10 0 23820 EVER Everglades NP 1992 ## 155 11 0 30644 EVER Everglades NP 1992 ## 156 12 101 81536 EVER Everglades NP 1992 ## 157 1 7386 106855 EVER Everglades NP 1993 ## 158 2 7199 119887 EVER Everglades NP 1993 ## 159 3 8078 121353 EVER Everglades NP 1993 ## 160 4 7478 96384 EVER Everglades NP 1993 ## 161 5 7178 76531 EVER Everglades NP 1993 ## 162 6 6816 62341 EVER Everglades NP 1993 ## 163 7 6752 66214 EVER Everglades NP 1993 ## 164 8 6317 61743 EVER Everglades NP 1993 ## 165 9 6773 51114 EVER Everglades NP 1993 ## 166 10 7322 58058 EVER Everglades NP 1993 ## [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 338 rows ] #For THRO unit_visitation&lt;- function(year_start=&quot;1980&quot;,year_end=&quot;2021&quot;, month_start=&quot;1&quot;,month_end=&quot;12&quot;,id_name=&quot;THRO&quot;){ get_data_year&lt;- GET(url =paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } unit_visitation() ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 623 7163 THRO Theodore Roosevelt NP 1980 ## 2 2 623 9360 THRO Theodore Roosevelt NP 1980 ## 3 3 623 13600 THRO Theodore Roosevelt NP 1980 ## 4 4 623 23208 THRO Theodore Roosevelt NP 1980 ## 5 5 623 45336 THRO Theodore Roosevelt NP 1980 ## 6 6 623 95326 THRO Theodore Roosevelt NP 1980 ## 7 7 623 139403 THRO Theodore Roosevelt NP 1980 ## 8 8 623 134231 THRO Theodore Roosevelt NP 1980 ## 9 9 623 58950 THRO Theodore Roosevelt NP 1980 ## 10 10 623 33584 THRO Theodore Roosevelt NP 1980 ## 11 11 623 20215 THRO Theodore Roosevelt NP 1980 ## 12 12 623 15358 THRO Theodore Roosevelt NP 1980 ## 13 1 623 12863 THRO Theodore Roosevelt NP 1981 ## 14 2 623 11869 THRO Theodore Roosevelt NP 1981 ## 15 3 623 23660 THRO Theodore Roosevelt NP 1981 ## 16 4 623 31275 THRO Theodore Roosevelt NP 1981 ## 17 5 623 47800 THRO Theodore Roosevelt NP 1981 ## 18 6 623 118774 THRO Theodore Roosevelt NP 1981 ## 19 7 623 160099 THRO Theodore Roosevelt NP 1981 ## 20 8 623 150545 THRO Theodore Roosevelt NP 1981 ## 21 9 623 73994 THRO Theodore Roosevelt NP 1981 ## 22 10 623 38338 THRO Theodore Roosevelt NP 1981 ## 23 11 623 20757 THRO Theodore Roosevelt NP 1981 ## 24 12 623 12899 THRO Theodore Roosevelt NP 1981 ## 25 1 623 11132 THRO Theodore Roosevelt NP 1982 ## 26 2 623 10927 THRO Theodore Roosevelt NP 1982 ## 27 3 623 20793 THRO Theodore Roosevelt NP 1982 ## 28 4 623 25464 THRO Theodore Roosevelt NP 1982 ## 29 5 623 46622 THRO Theodore Roosevelt NP 1982 ## 30 6 623 120067 THRO Theodore Roosevelt NP 1982 ## 31 7 623 170939 THRO Theodore Roosevelt NP 1982 ## 32 8 623 144195 THRO Theodore Roosevelt NP 1982 ## 33 9 623 71313 THRO Theodore Roosevelt NP 1982 ## 34 10 623 33194 THRO Theodore Roosevelt NP 1982 ## 35 11 623 18156 THRO Theodore Roosevelt NP 1982 ## 36 12 623 4212 THRO Theodore Roosevelt NP 1982 ## 37 1 623 3175 THRO Theodore Roosevelt NP 1983 ## 38 2 623 4303 THRO Theodore Roosevelt NP 1983 ## 39 3 623 4954 THRO Theodore Roosevelt NP 1983 ## 40 4 623 17147 THRO Theodore Roosevelt NP 1983 ## 41 5 623 33260 THRO Theodore Roosevelt NP 1983 ## 42 6 623 75517 THRO Theodore Roosevelt NP 1983 ## 43 7 623 118911 THRO Theodore Roosevelt NP 1983 ## 44 8 623 105025 THRO Theodore Roosevelt NP 1983 ## 45 9 623 42446 THRO Theodore Roosevelt NP 1983 ## 46 10 623 6556 THRO Theodore Roosevelt NP 1983 ## 47 11 623 2224 THRO Theodore Roosevelt NP 1983 ## 48 12 623 1600 THRO Theodore Roosevelt NP 1983 ## 49 1 623 308 THRO Theodore Roosevelt NP 1984 ## 50 2 623 663 THRO Theodore Roosevelt NP 1984 ## 51 3 623 2250 THRO Theodore Roosevelt NP 1984 ## 52 4 623 4341 THRO Theodore Roosevelt NP 1984 ## 53 5 623 29993 THRO Theodore Roosevelt NP 1984 ## 54 6 623 64834 THRO Theodore Roosevelt NP 1984 ## 55 7 623 101202 THRO Theodore Roosevelt NP 1984 ## 56 8 623 97898 THRO Theodore Roosevelt NP 1984 ## 57 9 623 37555 THRO Theodore Roosevelt NP 1984 ## 58 10 623 16078 THRO Theodore Roosevelt NP 1984 ## 59 11 623 4619 THRO Theodore Roosevelt NP 1984 ## 60 12 623 1398 THRO Theodore Roosevelt NP 1984 ## 61 1 434 1137 THRO Theodore Roosevelt NP 1985 ## 62 2 434 1217 THRO Theodore Roosevelt NP 1985 ## 63 3 434 3940 THRO Theodore Roosevelt NP 1985 ## 64 4 623 4273 THRO Theodore Roosevelt NP 1985 ## 65 5 623 35961 THRO Theodore Roosevelt NP 1985 ## 66 6 623 73947 THRO Theodore Roosevelt NP 1985 ## 67 7 623 101254 THRO Theodore Roosevelt NP 1985 ## 68 8 623 96851 THRO Theodore Roosevelt NP 1985 ## 69 9 623 35952 THRO Theodore Roosevelt NP 1985 ## 70 10 623 16229 THRO Theodore Roosevelt NP 1985 ## 71 11 434 4980 THRO Theodore Roosevelt NP 1985 ## 72 12 434 1411 THRO Theodore Roosevelt NP 1985 ## 73 1 434 772 THRO Theodore Roosevelt NP 1986 ## 74 2 434 573 THRO Theodore Roosevelt NP 1986 ## 75 3 434 3346 THRO Theodore Roosevelt NP 1986 ## 76 4 623 3700 THRO Theodore Roosevelt NP 1986 ## 77 5 623 31355 THRO Theodore Roosevelt NP 1986 ## 78 6 623 76456 THRO Theodore Roosevelt NP 1986 ## 79 7 623 115276 THRO Theodore Roosevelt NP 1986 ## 80 8 623 113280 THRO Theodore Roosevelt NP 1986 ## 81 9 623 34005 THRO Theodore Roosevelt NP 1986 ## 82 10 623 9507 THRO Theodore Roosevelt NP 1986 ## 83 11 434 1320 THRO Theodore Roosevelt NP 1986 ## 84 12 434 963 THRO Theodore Roosevelt NP 1986 ## 85 1 434 720 THRO Theodore Roosevelt NP 1987 ## 86 2 434 713 THRO Theodore Roosevelt NP 1987 ## 87 3 434 5767 THRO Theodore Roosevelt NP 1987 ## 88 4 623 13479 THRO Theodore Roosevelt NP 1987 ## 89 5 623 31685 THRO Theodore Roosevelt NP 1987 ## 90 6 623 77864 THRO Theodore Roosevelt NP 1987 ## 91 7 623 115896 THRO Theodore Roosevelt NP 1987 ## 92 8 623 111272 THRO Theodore Roosevelt NP 1987 ## 93 9 623 45217 THRO Theodore Roosevelt NP 1987 ## 94 10 623 16463 THRO Theodore Roosevelt NP 1987 ## 95 11 434 4318 THRO Theodore Roosevelt NP 1987 ## 96 12 434 1452 THRO Theodore Roosevelt NP 1987 ## 97 1 434 976 THRO Theodore Roosevelt NP 1988 ## 98 2 434 1536 THRO Theodore Roosevelt NP 1988 ## 99 3 434 3122 THRO Theodore Roosevelt NP 1988 ## 100 4 623 10509 THRO Theodore Roosevelt NP 1988 ## 101 5 623 32945 THRO Theodore Roosevelt NP 1988 ## 102 6 623 74553 THRO Theodore Roosevelt NP 1988 ## 103 7 623 113439 THRO Theodore Roosevelt NP 1988 ## 104 8 623 103574 THRO Theodore Roosevelt NP 1988 ## 105 9 623 46566 THRO Theodore Roosevelt NP 1988 ## 106 10 623 19343 THRO Theodore Roosevelt NP 1988 ## 107 11 434 5425 THRO Theodore Roosevelt NP 1988 ## 108 12 434 1539 THRO Theodore Roosevelt NP 1988 ## 109 1 434 1243 THRO Theodore Roosevelt NP 1989 ## 110 2 434 835 THRO Theodore Roosevelt NP 1989 ## 111 3 434 7436 THRO Theodore Roosevelt NP 1989 ## 112 4 623 14956 THRO Theodore Roosevelt NP 1989 ## 113 5 623 36527 THRO Theodore Roosevelt NP 1989 ## 114 6 623 87021 THRO Theodore Roosevelt NP 1989 ## 115 7 623 120566 THRO Theodore Roosevelt NP 1989 ## 116 8 623 111204 THRO Theodore Roosevelt NP 1989 ## 117 9 623 47975 THRO Theodore Roosevelt NP 1989 ## 118 10 623 20252 THRO Theodore Roosevelt NP 1989 ## 119 11 434 9516 THRO Theodore Roosevelt NP 1989 ## 120 12 434 1640 THRO Theodore Roosevelt NP 1989 ## 121 1 434 1044 THRO Theodore Roosevelt NP 1990 ## 122 2 434 1339 THRO Theodore Roosevelt NP 1990 ## 123 3 434 3636 THRO Theodore Roosevelt NP 1990 ## 124 4 623 16226 THRO Theodore Roosevelt NP 1990 ## 125 5 623 39255 THRO Theodore Roosevelt NP 1990 ## 126 6 623 88320 THRO Theodore Roosevelt NP 1990 ## 127 7 623 131586 THRO Theodore Roosevelt NP 1990 ## 128 8 623 118057 THRO Theodore Roosevelt NP 1990 ## 129 9 623 46139 THRO Theodore Roosevelt NP 1990 ## 130 10 623 9207 THRO Theodore Roosevelt NP 1990 ## 131 11 434 4326 THRO Theodore Roosevelt NP 1990 ## 132 12 434 1583 THRO Theodore Roosevelt NP 1990 ## 133 1 434 1387 THRO Theodore Roosevelt NP 1991 ## 134 2 434 1462 THRO Theodore Roosevelt NP 1991 ## 135 3 434 4332 THRO Theodore Roosevelt NP 1991 ## 136 4 623 13501 THRO Theodore Roosevelt NP 1991 ## 137 5 623 34713 THRO Theodore Roosevelt NP 1991 ## 138 6 623 83363 THRO Theodore Roosevelt NP 1991 ## 139 7 623 127724 THRO Theodore Roosevelt NP 1991 ## 140 8 623 129336 THRO Theodore Roosevelt NP 1991 ## 141 9 623 45886 THRO Theodore Roosevelt NP 1991 ## 142 10 623 20626 THRO Theodore Roosevelt NP 1991 ## 143 11 434 5220 THRO Theodore Roosevelt NP 1991 ## 144 12 434 1376 THRO Theodore Roosevelt NP 1991 ## 145 1 417 909 THRO Theodore Roosevelt NP 1992 ## 146 2 417 1026 THRO Theodore Roosevelt NP 1992 ## 147 3 472 3663 THRO Theodore Roosevelt NP 1992 ## 148 4 622 15052 THRO Theodore Roosevelt NP 1992 ## 149 5 623 35418 THRO Theodore Roosevelt NP 1992 ## 150 6 623 82069 THRO Theodore Roosevelt NP 1992 ## 151 7 622 134524 THRO Theodore Roosevelt NP 1992 ## 152 8 621 130518 THRO Theodore Roosevelt NP 1992 ## 153 9 624 47515 THRO Theodore Roosevelt NP 1992 ## 154 10 482 20176 THRO Theodore Roosevelt NP 1992 ## 155 11 472 4435 THRO Theodore Roosevelt NP 1992 ## 156 12 417 632 THRO Theodore Roosevelt NP 1992 ## 157 1 417 748 THRO Theodore Roosevelt NP 1993 ## 158 2 417 814 THRO Theodore Roosevelt NP 1993 ## 159 3 472 2212 THRO Theodore Roosevelt NP 1993 ## 160 4 622 14042 THRO Theodore Roosevelt NP 1993 ## 161 5 623 37693 THRO Theodore Roosevelt NP 1993 ## 162 6 623 80340 THRO Theodore Roosevelt NP 1993 ## 163 7 622 125177 THRO Theodore Roosevelt NP 1993 ## 164 8 621 136519 THRO Theodore Roosevelt NP 1993 ## 165 9 624 49363 THRO Theodore Roosevelt NP 1993 ## 166 10 482 22456 THRO Theodore Roosevelt NP 1993 ## [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 338 rows ] 1.6 Iterations At this point, we now know how to develop functions so that we do not have to keep writing out redundant steps in a workflow. However, in that last exercise, you can see that we are still writing out redundant code; we are performing the exact same function on each of our three park units. Another tool for reducing redundancy is iteration, which allows you to do the same thing on multiple inputs. Iteration can happen across different objects, different rows, different data frames, the list goes on and on! 1.7 For loops A for loop is base R’s iteration tool that executes code across a vector, an array, a list, etc. To save the outcome of each iteration, you must first create a vector to store the outputs in that is sized based on how many objects you want to iterate over. For example, I want to run our parkwide_visitation() function over the last five years: 2017, 2018, 2019, 2020, and 2021. To do that, I will first need to develop a vector listing each year: years &lt;- c(&#39;2017&#39;, &#39;2018&#39;, &#39;2019&#39;, &#39;2020&#39;, &#39;2021&#39;) … and then develop an empty list to store each year’s parkwide_visitation() results (i.e., output) into: output_floop &lt;- vector(&quot;list&quot;, length = length(years)) Now that we have a place to store each year’s function results, we can move forward with the for loop itself: for(i in 1:length(years)){ output_floop[[i]] &lt;- parkwide_visitation(year = years[i]) } … where years[i] tells the for loop to perform parkwide_visitation() on the ith year (think of i as a moving across each year), and output_floop[[i]] directs the for loop to store the results of the ith year’s run into output’s ith list (think of output_floop[[i]] as the location in output_floop that the ith’s results go). We now have a list containing five data frames: one for each year of visitation data: summary(output_floop) ## Length Class Mode ## [1,] 6 data.frame list ## [2,] 6 data.frame list ## [3,] 6 data.frame list ## [4,] 6 data.frame list ## [5,] 6 data.frame list Because each year’s output is structured identically, we can confidently combine each year’s data frame into a single data frame using dplyr::bind_rows(): multi_years &lt;- dplyr::bind_rows(output_floop) 1.7.1 Exercise #6 Use a for loop to run unit_visitation() with arguments start_year = 1980 and end_year = 2021 across ROMO, EVER, and THRO. Then, create a single data frame containing each park units’ output. (Hint: Your first step will be to create a vector listing each park unit.) #Defining the empty list various_ids&lt;- c(&quot;ROMO&quot;, &quot;EVER&quot;, &quot;THRO&quot;) id_output_floop &lt;- vector(&quot;list&quot;, length = length(various_ids)) for(i in 1:length(various_ids)){ id_output_floop[[i]]&lt;- unit_visitation(id_name = various_ids[i]) } summary(id_output_floop) ## Length Class Mode ## [1,] 6 data.frame list ## [2,] 6 data.frame list ## [3,] 6 data.frame list #Binding frames multi_ids_names &lt;- dplyr::bind_rows(id_output_floop) multi_ids_names ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 28 42902 ROMO Rocky Mountain NP 1980 ## 2 2 44 59403 ROMO Rocky Mountain NP 1980 ## 3 3 24 58790 ROMO Rocky Mountain NP 1980 ## 4 4 142 64299 ROMO Rocky Mountain NP 1980 ## 5 5 98 93210 ROMO Rocky Mountain NP 1980 ## 6 6 2384 410449 ROMO Rocky Mountain NP 1980 ## 7 7 3748 573465 ROMO Rocky Mountain NP 1980 ## 8 8 3634 609383 ROMO Rocky Mountain NP 1980 ## 9 9 1472 389771 ROMO Rocky Mountain NP 1980 ## 10 10 532 219495 ROMO Rocky Mountain NP 1980 ## 11 11 100 51344 ROMO Rocky Mountain NP 1980 ## 12 12 54 69426 ROMO Rocky Mountain NP 1980 ## 13 1 60 52645 ROMO Rocky Mountain NP 1981 ## 14 2 0 47256 ROMO Rocky Mountain NP 1981 ## 15 3 0 63637 ROMO Rocky Mountain NP 1981 ## 16 4 0 78529 ROMO Rocky Mountain NP 1981 ## 17 5 0 130744 ROMO Rocky Mountain NP 1981 ## 18 6 642 439671 ROMO Rocky Mountain NP 1981 ## 19 7 2130 674786 ROMO Rocky Mountain NP 1981 ## 20 8 1908 677202 ROMO Rocky Mountain NP 1981 ## 21 9 656 430738 ROMO Rocky Mountain NP 1981 ## 22 10 170 202193 ROMO Rocky Mountain NP 1981 ## 23 11 54 51650 ROMO Rocky Mountain NP 1981 ## 24 12 218 62191 ROMO Rocky Mountain NP 1981 ## 25 1 316 65547 ROMO Rocky Mountain NP 1982 ## 26 2 48 59558 ROMO Rocky Mountain NP 1982 ## 27 3 54 64554 ROMO Rocky Mountain NP 1982 ## 28 4 174 74092 ROMO Rocky Mountain NP 1982 ## 29 5 298 106375 ROMO Rocky Mountain NP 1982 ## 30 6 2796 366311 ROMO Rocky Mountain NP 1982 ## 31 7 3274 573923 ROMO Rocky Mountain NP 1982 ## 32 8 4406 613132 ROMO Rocky Mountain NP 1982 ## 33 9 2428 360870 ROMO Rocky Mountain NP 1982 ## 34 10 736 177760 ROMO Rocky Mountain NP 1982 ## 35 11 58 51377 ROMO Rocky Mountain NP 1982 ## 36 12 198 50617 ROMO Rocky Mountain NP 1982 ## 37 1 3778 67598 ROMO Rocky Mountain NP 1983 ## 38 2 2644 70480 ROMO Rocky Mountain NP 1983 ## 39 3 2560 60310 ROMO Rocky Mountain NP 1983 ## 40 4 4563 79542 ROMO Rocky Mountain NP 1983 ## 41 5 4257 91340 ROMO Rocky Mountain NP 1983 ## 42 6 9011 322393 ROMO Rocky Mountain NP 1983 ## 43 7 15891 552473 ROMO Rocky Mountain NP 1983 ## 44 8 23219 625132 ROMO Rocky Mountain NP 1983 ## 45 9 14202 432745 ROMO Rocky Mountain NP 1983 ## 46 10 10841 193914 ROMO Rocky Mountain NP 1983 ## 47 11 6370 76969 ROMO Rocky Mountain NP 1983 ## 48 12 4744 26110 ROMO Rocky Mountain NP 1983 ## 49 1 5253 51124 ROMO Rocky Mountain NP 1984 ## 50 2 4257 49126 ROMO Rocky Mountain NP 1984 ## 51 3 3165 46210 ROMO Rocky Mountain NP 1984 ## 52 4 3174 46736 ROMO Rocky Mountain NP 1984 ## 53 5 4212 75806 ROMO Rocky Mountain NP 1984 ## 54 6 14464 303393 ROMO Rocky Mountain NP 1984 ## 55 7 27018 514848 ROMO Rocky Mountain NP 1984 ## 56 8 30006 605465 ROMO Rocky Mountain NP 1984 ## 57 9 63411 355768 ROMO Rocky Mountain NP 1984 ## 58 10 75817 93927 ROMO Rocky Mountain NP 1984 ## 59 11 2951 52850 ROMO Rocky Mountain NP 1984 ## 60 12 458 36195 ROMO Rocky Mountain NP 1984 ## 61 1 5832 68416 ROMO Rocky Mountain NP 1985 ## 62 2 3676 47012 ROMO Rocky Mountain NP 1985 ## 63 3 865 55707 ROMO Rocky Mountain NP 1985 ## 64 4 1513 58854 ROMO Rocky Mountain NP 1985 ## 65 5 1949 117475 ROMO Rocky Mountain NP 1985 ## 66 6 12852 327505 ROMO Rocky Mountain NP 1985 ## 67 7 27504 501624 ROMO Rocky Mountain NP 1985 ## 68 8 26757 585115 ROMO Rocky Mountain NP 1985 ## 69 9 12828 304574 ROMO Rocky Mountain NP 1985 ## 70 10 4048 87250 ROMO Rocky Mountain NP 1985 ## 71 11 3285 52986 ROMO Rocky Mountain NP 1985 ## 72 12 4515 42336 ROMO Rocky Mountain NP 1985 ## 73 1 7281 74949 ROMO Rocky Mountain NP 1986 ## 74 2 4342 38588 ROMO Rocky Mountain NP 1986 ## 75 3 4653 58001 ROMO Rocky Mountain NP 1986 ## 76 4 2424 67259 ROMO Rocky Mountain NP 1986 ## 77 5 3197 111710 ROMO Rocky Mountain NP 1986 ## 78 6 9976 303208 ROMO Rocky Mountain NP 1986 ## 79 7 24774 547751 ROMO Rocky Mountain NP 1986 ## 80 8 27016 643670 ROMO Rocky Mountain NP 1986 ## 81 9 13184 338915 ROMO Rocky Mountain NP 1986 ## 82 10 6925 126243 ROMO Rocky Mountain NP 1986 ## 83 11 5671 45674 ROMO Rocky Mountain NP 1986 ## 84 12 5445 52266 ROMO Rocky Mountain NP 1986 ## 85 1 2917 77184 ROMO Rocky Mountain NP 1987 ## 86 2 12844 52922 ROMO Rocky Mountain NP 1987 ## 87 3 2684 54316 ROMO Rocky Mountain NP 1987 ## 88 4 3380 59363 ROMO Rocky Mountain NP 1987 ## 89 5 6704 136049 ROMO Rocky Mountain NP 1987 ## 90 6 16155 365757 ROMO Rocky Mountain NP 1987 ## 91 7 25768 546231 ROMO Rocky Mountain NP 1987 ## 92 8 26661 621584 ROMO Rocky Mountain NP 1987 ## 93 9 16015 359746 ROMO Rocky Mountain NP 1987 ## 94 10 7265 171484 ROMO Rocky Mountain NP 1987 ## 95 11 6969 50425 ROMO Rocky Mountain NP 1987 ## 96 12 5803 36803 ROMO Rocky Mountain NP 1987 ## 97 1 8191 58824 ROMO Rocky Mountain NP 1988 ## 98 2 8718 52367 ROMO Rocky Mountain NP 1988 ## 99 3 2542 56677 ROMO Rocky Mountain NP 1988 ## 100 4 3584 57933 ROMO Rocky Mountain NP 1988 ## 101 5 2016 91676 ROMO Rocky Mountain NP 1988 ## 102 6 20746 399197 ROMO Rocky Mountain NP 1988 ## 103 7 24083 568028 ROMO Rocky Mountain NP 1988 ## 104 8 30133 617184 ROMO Rocky Mountain NP 1988 ## 105 9 18607 371318 ROMO Rocky Mountain NP 1988 ## 106 10 9106 178657 ROMO Rocky Mountain NP 1988 ## 107 11 7029 55402 ROMO Rocky Mountain NP 1988 ## 108 12 7950 36948 ROMO Rocky Mountain NP 1988 ## 109 1 9784 60075 ROMO Rocky Mountain NP 1989 ## 110 2 9001 52050 ROMO Rocky Mountain NP 1989 ## 111 3 5582 60381 ROMO Rocky Mountain NP 1989 ## 112 4 2510 52044 ROMO Rocky Mountain NP 1989 ## 113 5 7934 92436 ROMO Rocky Mountain NP 1989 ## 114 6 18451 370174 ROMO Rocky Mountain NP 1989 ## 115 7 24557 590130 ROMO Rocky Mountain NP 1989 ## 116 8 21097 600617 ROMO Rocky Mountain NP 1989 ## 117 9 14738 358910 ROMO Rocky Mountain NP 1989 ## 118 10 9143 183199 ROMO Rocky Mountain NP 1989 ## 119 11 5102 54061 ROMO Rocky Mountain NP 1989 ## 120 12 5848 28838 ROMO Rocky Mountain NP 1989 ## 121 1 10956 53565 ROMO Rocky Mountain NP 1990 ## 122 2 9343 49896 ROMO Rocky Mountain NP 1990 ## 123 3 7247 65280 ROMO Rocky Mountain NP 1990 ## 124 4 4681 60274 ROMO Rocky Mountain NP 1990 ## 125 5 11465 108881 ROMO Rocky Mountain NP 1990 ## 126 6 17173 435279 ROMO Rocky Mountain NP 1990 ## 127 7 28031 560806 ROMO Rocky Mountain NP 1990 ## 128 8 30676 646018 ROMO Rocky Mountain NP 1990 ## 129 9 13162 392873 ROMO Rocky Mountain NP 1990 ## 130 10 9608 164130 ROMO Rocky Mountain NP 1990 ## 131 11 5749 73064 ROMO Rocky Mountain NP 1990 ## 132 12 5845 37257 ROMO Rocky Mountain NP 1990 ## 133 1 8071 50910 ROMO Rocky Mountain NP 1991 ## 134 2 6467 57547 ROMO Rocky Mountain NP 1991 ## 135 3 8492 56241 ROMO Rocky Mountain NP 1991 ## 136 4 6231 67986 ROMO Rocky Mountain NP 1991 ## 137 5 13124 118351 ROMO Rocky Mountain NP 1991 ## 138 6 18645 434810 ROMO Rocky Mountain NP 1991 ## 139 7 28663 614118 ROMO Rocky Mountain NP 1991 ## 140 8 25541 642734 ROMO Rocky Mountain NP 1991 ## 141 9 19042 385524 ROMO Rocky Mountain NP 1991 ## 142 10 9185 237608 ROMO Rocky Mountain NP 1991 ## 143 11 2815 43136 ROMO Rocky Mountain NP 1991 ## 144 12 5754 42816 ROMO Rocky Mountain NP 1991 ## 145 1 9398 60038 ROMO Rocky Mountain NP 1992 ## 146 2 9674 48476 ROMO Rocky Mountain NP 1992 ## 147 3 6444 58478 ROMO Rocky Mountain NP 1992 ## 148 4 4797 80217 ROMO Rocky Mountain NP 1992 ## 149 5 11308 160788 ROMO Rocky Mountain NP 1992 ## 150 6 15198 408630 ROMO Rocky Mountain NP 1992 ## 151 7 28690 606764 ROMO Rocky Mountain NP 1992 ## 152 8 24688 623634 ROMO Rocky Mountain NP 1992 ## 153 9 20790 440843 ROMO Rocky Mountain NP 1992 ## 154 10 12764 218570 ROMO Rocky Mountain NP 1992 ## 155 11 4346 47490 ROMO Rocky Mountain NP 1992 ## 156 12 5778 34940 ROMO Rocky Mountain NP 1992 ## 157 1 9015 53780 ROMO Rocky Mountain NP 1993 ## 158 2 8490 39962 ROMO Rocky Mountain NP 1993 ## 159 3 7375 52511 ROMO Rocky Mountain NP 1993 ## 160 4 5256 65790 ROMO Rocky Mountain NP 1993 ## 161 5 7498 120708 ROMO Rocky Mountain NP 1993 ## 162 6 20483 424670 ROMO Rocky Mountain NP 1993 ## 163 7 31510 623451 ROMO Rocky Mountain NP 1993 ## 164 8 36845 654327 ROMO Rocky Mountain NP 1993 ## 165 9 22219 423570 ROMO Rocky Mountain NP 1993 ## 166 10 11741 230972 ROMO Rocky Mountain NP 1993 ## [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1346 rows ] 1.8 Mapping The tidyverse’s purrr package has its own iteration function, map(), that is a variation of the for loop. map() takes a vector and applies a single function across it, then automatically stores all of the results into a list. In other words, map() creates an appropriately sized list to store our results in for us. This eliminates the need to create an empty list ahead of time. To create the same output as our previous for loop on parkwide_visitation(), but using map() instead, we would run the following code: ITERATION FUNCTION == map() in purrr and tidyverse output_map &lt;- years %&gt;% map(~ parkwide_visitation(year = .)) … where ~ indicates that we want to perform parkwide_visitation() across all years, and . indicates that we want to use our piped vector, years, as the input to the year argument. As you can see, output_map is identical to output_floop: identical(output_floop, output_map) ## [1] TRUE … which means we should also bind_rows() to get the mapped output into a single data frame: multi_years &lt;- bind_rows(output_map) 1.8.1 Exercise #7 Use map() to run unit_visitation() with arguments start_year = 1980 and end_year = 2021 across ROMO, EVER, and THRO. Then, create a single data frame containing each park units’ output. #First part: Previous code unit_visitation&lt;- function(year_start=&quot;1980&quot;,year_end=&quot;2021&quot;, month_start=&quot;1&quot;,month_end=&quot;12&quot;,id_name=&quot;ROMO&quot;){ get_data_year&lt;- GET(url =paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } # Second part: using loop various_ids&lt;- c(&quot;ROMO&quot;, &quot;EVER&quot;, &quot;THRO&quot;) id_output_floop &lt;- vector(&quot;list&quot;, length = length(various_ids)) for(i in 1:length(various_ids)){ id_output_floop[[i]]&lt;- unit_visitation(id_name = various_ids[i]) } #Based on our previous unit_visitation() various_ids&lt;- c(&quot;ROMO&quot;, &quot;EVER&quot;, &quot;THRO&quot;) output_map_unit &lt;- various_ids %&gt;% map(~ unit_visitation(id_name = .)) multi_ids &lt;- bind_rows(output_map_unit) multi_ids ## Month NonRecreationVisitors RecreationVisitors UnitCode UnitName Year ## 1 1 28 42902 ROMO Rocky Mountain NP 1980 ## 2 2 44 59403 ROMO Rocky Mountain NP 1980 ## 3 3 24 58790 ROMO Rocky Mountain NP 1980 ## 4 4 142 64299 ROMO Rocky Mountain NP 1980 ## 5 5 98 93210 ROMO Rocky Mountain NP 1980 ## 6 6 2384 410449 ROMO Rocky Mountain NP 1980 ## 7 7 3748 573465 ROMO Rocky Mountain NP 1980 ## 8 8 3634 609383 ROMO Rocky Mountain NP 1980 ## 9 9 1472 389771 ROMO Rocky Mountain NP 1980 ## 10 10 532 219495 ROMO Rocky Mountain NP 1980 ## 11 11 100 51344 ROMO Rocky Mountain NP 1980 ## 12 12 54 69426 ROMO Rocky Mountain NP 1980 ## 13 1 60 52645 ROMO Rocky Mountain NP 1981 ## 14 2 0 47256 ROMO Rocky Mountain NP 1981 ## 15 3 0 63637 ROMO Rocky Mountain NP 1981 ## 16 4 0 78529 ROMO Rocky Mountain NP 1981 ## 17 5 0 130744 ROMO Rocky Mountain NP 1981 ## 18 6 642 439671 ROMO Rocky Mountain NP 1981 ## 19 7 2130 674786 ROMO Rocky Mountain NP 1981 ## 20 8 1908 677202 ROMO Rocky Mountain NP 1981 ## 21 9 656 430738 ROMO Rocky Mountain NP 1981 ## 22 10 170 202193 ROMO Rocky Mountain NP 1981 ## 23 11 54 51650 ROMO Rocky Mountain NP 1981 ## 24 12 218 62191 ROMO Rocky Mountain NP 1981 ## 25 1 316 65547 ROMO Rocky Mountain NP 1982 ## 26 2 48 59558 ROMO Rocky Mountain NP 1982 ## 27 3 54 64554 ROMO Rocky Mountain NP 1982 ## 28 4 174 74092 ROMO Rocky Mountain NP 1982 ## 29 5 298 106375 ROMO Rocky Mountain NP 1982 ## 30 6 2796 366311 ROMO Rocky Mountain NP 1982 ## 31 7 3274 573923 ROMO Rocky Mountain NP 1982 ## 32 8 4406 613132 ROMO Rocky Mountain NP 1982 ## 33 9 2428 360870 ROMO Rocky Mountain NP 1982 ## 34 10 736 177760 ROMO Rocky Mountain NP 1982 ## 35 11 58 51377 ROMO Rocky Mountain NP 1982 ## 36 12 198 50617 ROMO Rocky Mountain NP 1982 ## 37 1 3778 67598 ROMO Rocky Mountain NP 1983 ## 38 2 2644 70480 ROMO Rocky Mountain NP 1983 ## 39 3 2560 60310 ROMO Rocky Mountain NP 1983 ## 40 4 4563 79542 ROMO Rocky Mountain NP 1983 ## 41 5 4257 91340 ROMO Rocky Mountain NP 1983 ## 42 6 9011 322393 ROMO Rocky Mountain NP 1983 ## 43 7 15891 552473 ROMO Rocky Mountain NP 1983 ## 44 8 23219 625132 ROMO Rocky Mountain NP 1983 ## 45 9 14202 432745 ROMO Rocky Mountain NP 1983 ## 46 10 10841 193914 ROMO Rocky Mountain NP 1983 ## 47 11 6370 76969 ROMO Rocky Mountain NP 1983 ## 48 12 4744 26110 ROMO Rocky Mountain NP 1983 ## 49 1 5253 51124 ROMO Rocky Mountain NP 1984 ## 50 2 4257 49126 ROMO Rocky Mountain NP 1984 ## 51 3 3165 46210 ROMO Rocky Mountain NP 1984 ## 52 4 3174 46736 ROMO Rocky Mountain NP 1984 ## 53 5 4212 75806 ROMO Rocky Mountain NP 1984 ## 54 6 14464 303393 ROMO Rocky Mountain NP 1984 ## 55 7 27018 514848 ROMO Rocky Mountain NP 1984 ## 56 8 30006 605465 ROMO Rocky Mountain NP 1984 ## 57 9 63411 355768 ROMO Rocky Mountain NP 1984 ## 58 10 75817 93927 ROMO Rocky Mountain NP 1984 ## 59 11 2951 52850 ROMO Rocky Mountain NP 1984 ## 60 12 458 36195 ROMO Rocky Mountain NP 1984 ## 61 1 5832 68416 ROMO Rocky Mountain NP 1985 ## 62 2 3676 47012 ROMO Rocky Mountain NP 1985 ## 63 3 865 55707 ROMO Rocky Mountain NP 1985 ## 64 4 1513 58854 ROMO Rocky Mountain NP 1985 ## 65 5 1949 117475 ROMO Rocky Mountain NP 1985 ## 66 6 12852 327505 ROMO Rocky Mountain NP 1985 ## 67 7 27504 501624 ROMO Rocky Mountain NP 1985 ## 68 8 26757 585115 ROMO Rocky Mountain NP 1985 ## 69 9 12828 304574 ROMO Rocky Mountain NP 1985 ## 70 10 4048 87250 ROMO Rocky Mountain NP 1985 ## 71 11 3285 52986 ROMO Rocky Mountain NP 1985 ## 72 12 4515 42336 ROMO Rocky Mountain NP 1985 ## 73 1 7281 74949 ROMO Rocky Mountain NP 1986 ## 74 2 4342 38588 ROMO Rocky Mountain NP 1986 ## 75 3 4653 58001 ROMO Rocky Mountain NP 1986 ## 76 4 2424 67259 ROMO Rocky Mountain NP 1986 ## 77 5 3197 111710 ROMO Rocky Mountain NP 1986 ## 78 6 9976 303208 ROMO Rocky Mountain NP 1986 ## 79 7 24774 547751 ROMO Rocky Mountain NP 1986 ## 80 8 27016 643670 ROMO Rocky Mountain NP 1986 ## 81 9 13184 338915 ROMO Rocky Mountain NP 1986 ## 82 10 6925 126243 ROMO Rocky Mountain NP 1986 ## 83 11 5671 45674 ROMO Rocky Mountain NP 1986 ## 84 12 5445 52266 ROMO Rocky Mountain NP 1986 ## 85 1 2917 77184 ROMO Rocky Mountain NP 1987 ## 86 2 12844 52922 ROMO Rocky Mountain NP 1987 ## 87 3 2684 54316 ROMO Rocky Mountain NP 1987 ## 88 4 3380 59363 ROMO Rocky Mountain NP 1987 ## 89 5 6704 136049 ROMO Rocky Mountain NP 1987 ## 90 6 16155 365757 ROMO Rocky Mountain NP 1987 ## 91 7 25768 546231 ROMO Rocky Mountain NP 1987 ## 92 8 26661 621584 ROMO Rocky Mountain NP 1987 ## 93 9 16015 359746 ROMO Rocky Mountain NP 1987 ## 94 10 7265 171484 ROMO Rocky Mountain NP 1987 ## 95 11 6969 50425 ROMO Rocky Mountain NP 1987 ## 96 12 5803 36803 ROMO Rocky Mountain NP 1987 ## 97 1 8191 58824 ROMO Rocky Mountain NP 1988 ## 98 2 8718 52367 ROMO Rocky Mountain NP 1988 ## 99 3 2542 56677 ROMO Rocky Mountain NP 1988 ## 100 4 3584 57933 ROMO Rocky Mountain NP 1988 ## 101 5 2016 91676 ROMO Rocky Mountain NP 1988 ## 102 6 20746 399197 ROMO Rocky Mountain NP 1988 ## 103 7 24083 568028 ROMO Rocky Mountain NP 1988 ## 104 8 30133 617184 ROMO Rocky Mountain NP 1988 ## 105 9 18607 371318 ROMO Rocky Mountain NP 1988 ## 106 10 9106 178657 ROMO Rocky Mountain NP 1988 ## 107 11 7029 55402 ROMO Rocky Mountain NP 1988 ## 108 12 7950 36948 ROMO Rocky Mountain NP 1988 ## 109 1 9784 60075 ROMO Rocky Mountain NP 1989 ## 110 2 9001 52050 ROMO Rocky Mountain NP 1989 ## 111 3 5582 60381 ROMO Rocky Mountain NP 1989 ## 112 4 2510 52044 ROMO Rocky Mountain NP 1989 ## 113 5 7934 92436 ROMO Rocky Mountain NP 1989 ## 114 6 18451 370174 ROMO Rocky Mountain NP 1989 ## 115 7 24557 590130 ROMO Rocky Mountain NP 1989 ## 116 8 21097 600617 ROMO Rocky Mountain NP 1989 ## 117 9 14738 358910 ROMO Rocky Mountain NP 1989 ## 118 10 9143 183199 ROMO Rocky Mountain NP 1989 ## 119 11 5102 54061 ROMO Rocky Mountain NP 1989 ## 120 12 5848 28838 ROMO Rocky Mountain NP 1989 ## 121 1 10956 53565 ROMO Rocky Mountain NP 1990 ## 122 2 9343 49896 ROMO Rocky Mountain NP 1990 ## 123 3 7247 65280 ROMO Rocky Mountain NP 1990 ## 124 4 4681 60274 ROMO Rocky Mountain NP 1990 ## 125 5 11465 108881 ROMO Rocky Mountain NP 1990 ## 126 6 17173 435279 ROMO Rocky Mountain NP 1990 ## 127 7 28031 560806 ROMO Rocky Mountain NP 1990 ## 128 8 30676 646018 ROMO Rocky Mountain NP 1990 ## 129 9 13162 392873 ROMO Rocky Mountain NP 1990 ## 130 10 9608 164130 ROMO Rocky Mountain NP 1990 ## 131 11 5749 73064 ROMO Rocky Mountain NP 1990 ## 132 12 5845 37257 ROMO Rocky Mountain NP 1990 ## 133 1 8071 50910 ROMO Rocky Mountain NP 1991 ## 134 2 6467 57547 ROMO Rocky Mountain NP 1991 ## 135 3 8492 56241 ROMO Rocky Mountain NP 1991 ## 136 4 6231 67986 ROMO Rocky Mountain NP 1991 ## 137 5 13124 118351 ROMO Rocky Mountain NP 1991 ## 138 6 18645 434810 ROMO Rocky Mountain NP 1991 ## 139 7 28663 614118 ROMO Rocky Mountain NP 1991 ## 140 8 25541 642734 ROMO Rocky Mountain NP 1991 ## 141 9 19042 385524 ROMO Rocky Mountain NP 1991 ## 142 10 9185 237608 ROMO Rocky Mountain NP 1991 ## 143 11 2815 43136 ROMO Rocky Mountain NP 1991 ## 144 12 5754 42816 ROMO Rocky Mountain NP 1991 ## 145 1 9398 60038 ROMO Rocky Mountain NP 1992 ## 146 2 9674 48476 ROMO Rocky Mountain NP 1992 ## 147 3 6444 58478 ROMO Rocky Mountain NP 1992 ## 148 4 4797 80217 ROMO Rocky Mountain NP 1992 ## 149 5 11308 160788 ROMO Rocky Mountain NP 1992 ## 150 6 15198 408630 ROMO Rocky Mountain NP 1992 ## 151 7 28690 606764 ROMO Rocky Mountain NP 1992 ## 152 8 24688 623634 ROMO Rocky Mountain NP 1992 ## 153 9 20790 440843 ROMO Rocky Mountain NP 1992 ## 154 10 12764 218570 ROMO Rocky Mountain NP 1992 ## 155 11 4346 47490 ROMO Rocky Mountain NP 1992 ## 156 12 5778 34940 ROMO Rocky Mountain NP 1992 ## 157 1 9015 53780 ROMO Rocky Mountain NP 1993 ## 158 2 8490 39962 ROMO Rocky Mountain NP 1993 ## 159 3 7375 52511 ROMO Rocky Mountain NP 1993 ## 160 4 5256 65790 ROMO Rocky Mountain NP 1993 ## 161 5 7498 120708 ROMO Rocky Mountain NP 1993 ## 162 6 20483 424670 ROMO Rocky Mountain NP 1993 ## 163 7 31510 623451 ROMO Rocky Mountain NP 1993 ## 164 8 36845 654327 ROMO Rocky Mountain NP 1993 ## 165 9 22219 423570 ROMO Rocky Mountain NP 1993 ## 166 10 11741 230972 ROMO Rocky Mountain NP 1993 ## [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1346 rows ] "],["data-munging.html", "Chapter 2 Data munging 2.1 Pulling in necessary packages and data sets 2.2 Exploring our data 2.3 Pivoting 2.4 Joining", " Chapter 2 Data munging 2.0.1 Lesson Objectives In the last lesson, we learned how to pull data from an API and reduce redundancies in our workflows through functions and iterations. In this lesson we will use the functions in the previous lesson to learn how to manipulate data frames with the tidyverse, and plot elegant time series graphs with the ggplot(), scales and plotly packages. There are five exercises in this lesson that must be completed. 2.1 Pulling in necessary packages and data sets library(tidyverse) library(httr) library(jsonlite) library(plotly) library(scales) Using the parkwide_visitation() function from the last lesson and mapping, let’s pull park-wide visitor data from 1980-2021, and name the final object parkwide. (Code hack: we can use 1980:2021 to create a vector of years so we don’t have to write each year out!) parkwide_visitation &lt;- function(year){ raw_data &lt;- httr::GET(url = paste0(&quot;https://irmaservices.nps.gov/v3/rest/stats/total/&quot;, year)) extracted_data &lt;- httr::content(raw_data, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data &lt;- jsonlite::fromJSON(extracted_data) return(final_data) } years &lt;- (1980:2021) #Way to define a frame time parkwide &lt;- years %&gt;% map(~ parkwide_visitation(year = .)) %&gt;% bind_rows() 2.1.1 Exercise #1 Using the unit_visitation() function from the last lesson and mapping, pull visitor data from 1980-2021 for the following park units: ROMO, ACAD, LAKE, YELL, GRCA, ZION, OLYM, and GRSM. Name the final output units. unit_visitation&lt;- function(year_start,year_end, month_start=1,month_end=12,id_name){ get_data_year&lt;- GET(url = paste0( &quot;https://irmaservices.nps.gov/v3/rest/stats/visitation?unitCodes=&quot;, id_name, &quot;&amp;startMonth=&quot;, month_start, &quot;&amp;startYear=&quot;, year_start, &quot;&amp;endMonth=&quot;, month_end, &quot;&amp;endYear=&quot;, year_end)) extracted_data_yell &lt;- httr::content( get_data_year, as = &quot;text&quot;, encoding = &quot;UTF-8&quot;) final_data_yell &lt;- jsonlite::fromJSON(extracted_data_yell) return(final_data_yell ) } parks&lt;- c(&quot;ROMO&quot;, &quot;ACAD&quot;, &quot;LAKE&quot;, &quot;YELL&quot;, &quot;GRCA&quot;, &quot;ZION&quot;, &quot;OLYM&quot;, &quot;GRSM&quot;) units &lt;- parks %&gt;% map(~ unit_visitation(id_name= ., year_start = 1980, year_end= 2021)) %&gt;% bind_rows() units 2.2 Exploring our data Look at the data frame structure of parkwide and units; they’re exactly the same! So let’s go ahead and bind those together: #Exploring data frames parkwide units visitation &lt;- bind_rows(parkwide, units) visitation … except, the rows in parkwide’s UnitCode and UnitCode columns are empty.  Let’s fix the UnitCode column to list “Parkwide” using mutate() and an ifelse() statement: visitation &lt;- visitation %&gt;% mutate(UnitCode = ifelse(is.na(UnitCode), &quot;Parkwide&quot;, UnitCode)) visitation Think of the above ifelse() operation as: “If the column UnitCode is NA, replace NA with Parkwide. Otherwise, preserve what is already in the UnitCode column.” Now that we have a single data set containing all of the NPS visitation data that we’ve pulled, let’s start exploring it! But first, let’s aggregate the monthly data into annual data using group_by() and summarize(): yearly &lt;- visitation %&gt;% group_by(Year,UnitCode) %&gt;% # we only care about recreational visitors: summarize(RecVisitation = sum(RecreationVisitors)) yearly What does visitation data look like through time? First we can try to graph all of the park units together: ggplot(data=yearly)+ geom_point(aes(x = Year, y = RecVisitation, color = UnitCode)) + geom_path(aes(x = Year, y = RecVisitation, color = UnitCode)) + scale_y_continuous(labels = scales::label_scientific()) + theme_bw(base_size=10) … yikes, not surprisingly, parkwide visitation is wayyyy higher than our individual unit’s visitation data, making our graph pretty useless. It might be nice to have each park unit in a graph of its own. We can create individual graphs for each unit using facet_wrap(), and set the y-axes for each plot to \"free_y\": ggplot(data=yearly) + geom_point(aes(x = Year, y = RecVisitation, color = UnitCode)) + geom_path(aes(x = Year, y = RecVisitation, color = UnitCode)) + scale_y_continuous(labels = scales::label_scientific()) + facet_wrap(~UnitCode, scales = &quot;free_y&quot;) + theme_bw(base_size=10) We can also make this plot interactive by feeding it into plotly’s ggplotly() function: plotly::ggplotly( ggplot(data=yearly) + geom_point(aes(x = Year, y = RecVisitation, color = UnitCode)) + geom_path(aes(x = Year, y = RecVisitation, color = UnitCode)) + scale_y_continuous(labels = scales::label_scientific()) + facet_wrap(~UnitCode, scales = &quot;free_y&quot;) + theme_bw(base_size=10) ) 2.2.1 Exercise #2 Create an interactive graph with two separate panes: one showing park-wide visitation, the other showing all the individual park units together. Both panes should have different y-axes. Graph_Parkwide&lt;- yearly %&gt;% filter((UnitCode == &quot;Parkwide&quot;)) plot_1&lt;- plotly::ggplotly( ggplot(data=Graph_Parkwide) + geom_line(aes(x = Year, y = RecVisitation ))+ scale_y_continuous(labels = scales::label_scientific()) + theme_bw(base_size=10) ) plot_1 Graph_Multiple_parks&lt;- yearly %&gt;% filter((UnitCode != &quot;Parkwide&quot;)) plot_2&lt;- plotly::ggplotly( ggplot(data=Graph_Multiple_parks) + geom_line(aes(x = Year, y = RecVisitation, color= UnitCode))+ scale_y_continuous(labels = scales::label_scientific()) + theme_bw(base_size=10) ) plot_2 #Combining graph subplot(plot_1, plot_2, nrows = 1) It is pretty clear that some park units get orders of magnitude more visitors than others. But just how much of the total park visitation do each of these parks account for from year to year? Here we walk through two methods to tackle this question, pivoting and joining, to get park unit visitation side-by-side with park-wide data. 2.3 Pivoting Currently, our yearly data is considered narrow because we have all of our NPS visitation data in one column, with multiple rows representing the same year. We can make this data wide by using the function pivot_wider() wide_data &lt;- yearly %&gt;% select(Year, UnitCode, RecVisitation) %&gt;% pivot_wider(., names_from = UnitCode, values_from = RecVisitation) wide_data #Adding visitor into the current values unit_alien&lt;- wide_data%&gt;% mutate_at(.vars = parks, .funs = ~ (. + 70)) unit_alien #.vars replace c(&quot;name1&quot;, &quot;mane2&quot;, etc) … where names_from represents the column with the values you are hoping to spread into new columns, and values_from represents the data you want to fill these new columns with. We can make the data set narrow again by using the function pivot_longer(): narrow_data &lt;- wide_data %&gt;% pivot_longer(cols = -Year, names_to = &quot;park&quot;, values_to = &quot;RecVisitation&quot;) #Or we can use the &quot;UnitCode&quot; name narrow_data_1 &lt;- wide_data %&gt;% pivot_longer(cols = -Year, names_to = &quot;UnitCode&quot;, values_to = &quot;RecVisitation&quot;) … where cols are the columns we want to gather into one column (or, the column(s) you DON’T want to gather), while names_to and values_to are the names of the new columns produced from the pivot. 2.3.1 Exercise #3 Using wide_data as the starting point, create an interactive time series plot showing the annual percentage of the total visitation made up by all park units. #Summarizing unit parks in percentages unit_alien&lt;- wide_data %&gt;% group_by(Year) %&gt;% mutate_at(.vars= parks, .funs = ~(./Parkwide)*100)%&gt;% select(-Parkwide) unit_alien #Converting to longer data narrow_data_1 &lt;- unit_alien %&gt;% pivot_longer(cols = -Year, names_to = &quot;Variable&quot;, values_to = &quot;percentage&quot;) narrow_data_1 #Longer data used to create an interactive graph porcentage_interactive_map&lt;- plotly::ggplotly( ggplot(data=narrow_data_1) + geom_line(aes(x = Year, y = percentage, color= Variable))+ theme_bw(base_size=10) ) porcentage_interactive_map 2.4 Joining Another way of getting park-wide visitation side-by-side with the park unit data is through the use of joining our original units and parkwide data sets: joined_data &lt;- inner_join(x = units, y = parkwide, by = c(&quot;Year&quot;,&quot;Month&quot;)) head(joined_data) … where x and y are the two data sets you want joined, and by indicates the column(s) to match them by. Note: there are several ways of joining data. Explore them with ?`mutate-joins` and ?`filter-joins`. 2.4.1 Exercise #4 Using joined_data as the starting point, create an interactive time series plot showing the annual percentage of the total visitation made up by all park units. This plot should look nearly identical to the previous plot. head(joined_data) head(units) head(parkwide) # Replacing NA with Parkwide joined_data_first &lt;- joined_data %&gt;% mutate(UnitCode.y = if_else(is.na(UnitCode.y), &quot;Parkwide&quot;, &quot;&quot;)) head(joined_data_first) summuarizing&lt;-joined_data_first%&gt;% group_by(Year,UnitCode.x,UnitCode.y)%&gt;% summarise(sum_vitation_parks = sum(RecreationVisitors.x), sum_vitation_parkwide = sum(RecreationVisitors.y))%&gt;% mutate(porcentage_unit_parks= sum_vitation_parks*100/sum_vitation_parkwide)%&gt;% rename(Unit_parks=UnitCode.x, Porcentage_vitation=porcentage_unit_parks )%&gt;% select(Year,Unit_parks,Porcentage_vitation) head(summuarizing) #Interactive graphing interactive_map_porcentage_parks&lt;- plotly::ggplotly( ggplot(data=summuarizing) + geom_line(aes(x = Year, y = Porcentage_vitation, color= Unit_parks))+ theme_bw(base_size=10) ) interactive_map_porcentage_parks 2.4.2 Exercise #5 Which park on average has the most visitation? Which park has the least visitation? Base your response on the data starting in 1990, ending in 2021. Defend your answer with numbers! # I need to filter from 1990 to 2021 head(summuarizing) subseting&lt;-summuarizing%&gt;% filter(Year &gt;=1990 &amp; Year&lt;= 2021)%&gt;% select(Year, Unit_parks, Porcentage_vitation) head(subseting) #Averaging from 1990 to 2021 by park average_1900_2021&lt;- subseting%&gt;% group_by(Unit_parks)%&gt;% summarise(mean_years = mean(Porcentage_vitation)) head(average_1900_2021) #Identifying the park with the highest average across years highest_visitation&lt;-average_1900_2021%&gt;% arrange(desc(mean_years))%&gt;% slice(1) highest_visitation ## The park with the highest visitation percentage in average is GRSM with 3.5% from 1990 to 2021 #Identifying the park with the lowest average across years lowest_visitation&lt;-average_1900_2021%&gt;% arrange(mean_years)%&gt;% slice(1) lowest_visitation ## The park with the lowest visitation percentage in average is ACAD with 0.930 from 1990 to 2021 "],["denouement.html", "Chapter 3 Denouement 3.1 Lesson Objectives: 3.2 Streaflow Datasets 3.3 Exercise #1 3.4 Exercise #2 3.5 Exercise #3 3.6 Exercise #4 3.7 Exercise #5", " Chapter 3 Denouement 3.1 Lesson Objectives: In this lesson you will take all of the skills you have learned up to this point and use them on a completely new set of data. This lesson has five exercises that need to be completed. 3.1.0.1 Necessary packages: library(tidyverse) library(plotly) library(scales) library(httr) library(jsonlite) library(dataRetrieval) library(sf) # for the map library(mapview) # for making the interactive plot 3.2 Streaflow Datasets We are interested in looking at how the Cache la Poudre River’s flow changes as it travels out of the mountainous Poudre Canyon and through Fort Collins. There are four stream flow monitoring sites on the Poudre that we are interested in: two managed by the US Geological Survey (USGS), and two managed by the Colorado Division of Water Resources (CDWR): 3.2.1 USGS dataRetrieval R package To pull data for USGS stream gages, we can use the dataRetrieval package, which is a USGS-managed set of functions that, much like our functions from Lesson 3.1, pull data from the USGS’s data warehouse using an API. Here we will pull flow data for our USGS stream gages of interest for the last two water years: # pulls USGS daily (&#39;dv&#39;) stream flow data: usgs &lt;- dataRetrieval::readNWISdv(siteNumbers = c(&quot;06752260&quot;, &quot;06752280&quot;), # USGS site code for the Poudre River at the Lincoln Bridge and the ELC parameterCd = &quot;00060&quot;, # USGS code for stream flow startDate = &quot;2021-01-01&quot;, # YYYY-MM-DD formatting endDate = &quot;2022-12-31&quot;) %&gt;% # YYYY-MM-DD formatting rename(q_cfs = X_00060_00003) %&gt;% # USGS code for stream flow units in cubic feet per second (CFS) mutate(Date = lubridate::ymd(Date), # convert the Date column to &quot;Date&quot; formatting using the `lubridate` package Site = case_when(site_no == &quot;06752260&quot; ~ &quot;Lincoln&quot;, site_no == &quot;06752280&quot; ~ &quot;Boxelder&quot;)) 3.2.2 CDWR’s API Alas, CDWR does NOT have an R package that pulls data from their API, but they do have user-friendly directions on how to develop API calls. Using the “URL generator” steps outlined for their daily surface water time series data set, we can get the last two water years of CFS data for the Poudre at the Canyon mouth (site abbreviation = CLAFTCCO) using the following URL: https://dwr.state.co.us/Rest/GET/api/v2/surfacewater/surfacewatertsday/?format=json&amp;dateFormat=dateOnly&amp;fields=abbrev%2CmeasDate%2Cvalue%2CmeasUnit&amp;encoding=deflate&amp;abbrev=CLAFTCCO&amp;min-measDate=10%2F01%2F2020&amp;max-measDate=09%2F30%2F2022 3.3 Exercise #1 Using the URL above as the starting point, develop a function that creates a data frame of CDWR daily flow (CFS) data for a selected range of water years, for any site. (HINT: The final product of our API pull is a list with additional metadata about our API pull… how do we index a list to extract the time series flow data?) #Extracting data set start_date&lt;-&quot;2021-01-01&quot; end_date&lt;-&quot;2022-12-31&quot; #Creating the function co_water_data&lt;- function(abbrev, start_date=&quot;2021-01-01&quot;, end_date=&quot;2022-12-31&quot;){ test &lt;- GET(url = paste0(&quot;https://dwr.state.co.us/Rest/GET/api/v2/surfacewater/surfacewatertsday/?format=json&amp;dateFormat=dateOnly&amp;fields=abbrev%2CmeasDate%2Cvalue%2CmeasUnit&amp;encoding=deflate&amp;abbrev=&quot;,abbrev,&quot;&amp;min-measDate=&quot;, substr(start_date, 6, 7),&quot;%2F&quot;, substr(start_date, 9, 10),&quot;%2F&quot;, substr(start_date, 1, 4), &quot;&amp;max-measDate=&quot;,substr(end_date, 6,7),&quot;%2F&quot;,substr(end_date, 9,10), &quot;%2F&quot;,substr(end_date, 1, 4))) text &lt;- content(test, as = &quot;text&quot;, enconding = &quot;UTF-8&quot;) final_data_water &lt;- jsonlite::fromJSON(text)[[5]]} test_set &lt;- co_water_data(abbrev =&quot;CLAFTCCO&quot;, start_date , end_date ) test_set #how do we index a list to extract the time series flow data? #It was done adding to the jsonlite line code double [[]] and within it write the number 5 winch correspond to the frame that we are interested in. 3.4 Exercise #2 Map over the function you developed in Exercise #1 to pull flow data for CLAFTCCO and CLARIVCO for the 2021 and 2022 water years. # My previous function was already coded to extract data from 2021 to 2022 #Extracting &quot;CLAFTCCO&quot;, &quot;CLARIVCO&quot; parks from 2021 to 2022 various_ids_water&lt;- c(&quot;CLAFTCCO&quot;, &quot;CLARIVCO&quot;) output_map_id_water &lt;- various_ids_water %&gt;% map(~ co_water_data(abbrev = . ))%&gt;% bind_rows() output_map_id_water str(output_map_id_water) 3.5 Exercise #3 Join our USGS and CDWR data frames together (bind_rows(), perhaps?), then create an interactive ggplot of discharge (in CFS) through time displaying all four of our monitoring sites. Be sure all axes and labels are clear. # startDate = &quot;2021-01-01&quot;, endDate = &quot;2022-12-31&quot; for Lincoln, and Boxelder stations data_one_usgs1 &lt;-usgs data_one_Lincoln_Boxelder&lt;- data_one_usgs1 %&gt;% dplyr::select(Site,Date,q_cfs ) data_one_Lincoln_Boxelder head(data_one_Lincoln_Boxelder) #startDate= &quot;2021-01-01&quot;, endDate = &quot;2022-12-31&quot; fro CLAFTCCO, and CLARIVCO station data_two_format&lt;-(output_map_id_water) data_two_CLAFTCCO_CLARIVCO&lt;-data_two_format %&gt;% select(measDate,abbrev,value)%&gt;% mutate(Date = as.Date(measDate),Site=abbrev, q_cfs=value)%&gt;% select(Site,Date,q_cfs) data_two_CLAFTCCO_CLARIVCO head(data_two_CLAFTCCO_CLARIVCO) #Join data two data sets joined_datasets&lt;-bind_rows(data_two_CLAFTCCO_CLARIVCO,data_one_Lincoln_Boxelder) str(joined_datasets) #Creating an interactive ggplot ##Creating new equal format names mapping &lt;- c(&quot;CLAFTCCO&quot; = &quot;CLAFTCCO&quot;, &quot;CLARIVCO&quot; = &quot;CLARIVCO&quot;, &quot;Lincoln&quot; = &quot;LINCOLN&quot;, &quot;Boxelder&quot; = &quot;BOXELDER&quot;) re_name&lt;-joined_datasets%&gt;% mutate(Sites = recode(Site, !!!mapping))%&gt;% select(Date,Sites,q_cfs) re_name head(re_name) ##Graphing interactive_map&lt;- plotly::ggplotly( ggplot(data=re_name) + xlab(&quot;Time &quot;) + ylab(&quot;Discarge (CSF)&quot;)+ geom_line(aes(x = Date, y = q_cfs, color= Sites))+ theme_bw(base_size=10) ) interactive_map 3.6 Exercise #4 Create an interactive plot of the daily difference in discharge between the Cache la Poudre River at the canyon mouth and each of the sites downstream. Make sure your plot axes are clear. #Converting to wide data frame head(re_name) Stations&lt;-c( &quot;CLARIVCO&quot;, &quot;LINCOLN&quot;,&quot;BOXELDER&quot;) wide_data_stations &lt;- re_name %&gt;% select(Date, Sites, q_cfs) %&gt;% pivot_wider(., names_from = Sites, values_from = q_cfs) wide_data_stations #Calculating the differences unit_differences_stations&lt;- wide_data_stations %&gt;% group_by(Date) %&gt;% mutate_at(.vars= Stations, .funs = ~(CLAFTCCO- .))%&gt;% rename(differences_CLAFTCCO_CLARIVCO=CLARIVCO,differences_CLAFTCCO_LINCOLN= LINCOLN,differences_CLAFTCCO_BOXELDER=BOXELDER)%&gt;% select(-CLAFTCCO) unit_differences_stations longer_unit_stations&lt;- unit_differences_stations%&gt;% pivot_longer(cols = -Date, names_to = &quot;Stations&quot;, values_to = &quot;q_cfs&quot;) longer_unit_stations #Graphing the differences interactive_map_differences_stations&lt;- plotly::ggplotly( ggplot(data=longer_unit_stations) + xlab(&quot;Time &quot;) + ylab(&quot;Discarge (CSF)&quot;)+ geom_line(aes(x = Date, y = q_cfs, color= Stations))+ theme_bw(base_size=10) ) interactive_map_differences_stations 3.7 Exercise #5 For each of our downstream locations, calculate how many days the canyon mouth had LOWER flow. Is this what you expected? Why or why not? #Based on the discarge differences betweee Claftco - .var head(unit_differences_stations) #Tranforming from wide to pivot data unit_stations_longer&lt;- unit_differences_stations%&gt;% pivot_longer(cols = -Date, names_to = &quot;Stations&quot;, values_to = &quot;q_cfs&quot;) head(unit_stations_longer) #Grouping by Stations Grouping_statitons&lt;-unit_stations_longer%&gt;% group_by(Date,Stations)%&gt;% filter(q_cfs&lt; 0)%&gt;% summarise(q_cfs,n = n()) head(Grouping_statitons) total_negative_station&lt;-Grouping_statitons%&gt;% group_by(Stations)%&gt;% summarize(total_negative = sum(n)) head(total_negative_station) #Lincoln had 58 days with more discharge than the the canyon mouth. This result matches my expectation because on the downstream a significant amount of water is being using for agriculture. "],["introduction.html", "Introduction", " Introduction My second chance. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
